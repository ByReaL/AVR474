<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="atmel-header_files/filelist.xml">
<link rel=Edit-Time-Data href="atmel-header_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>@DOC_TITLE@</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>ping.zhou</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>ping.zhou</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Created>2010-08-04T02:58:00Z</o:Created>
  <o:LastSaved>2010-08-04T02:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>51</o:Words>
  <o:Characters>297</o:Characters>
  <o:Company>Atmel</o:Company>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>347</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<link rel=Stylesheet type="text/css" media=all href="doxygen.css">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellpadding=0 width="100%"
 style='width:100.0%;mso-cellspacing:1.5pt;background:white'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com"><span style='text-decoration:none;
  text-underline:none'><img border=0 width=109 height=50 id="_x0000_i1025"
  src=atmel.jpg></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span class=SpellE><strong><span style='font-size:24.0pt;
  font-family:Helvetica;color:black'>SmartBattery</span></strong></span><strong><span
  style='font-size:24.0pt;font-family:Helvetica;color:black'> Device
  Application Note</span></strong></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com/products/AVR"><span style='text-decoration:
  none;text-underline:none'><img border=0 width=138 height=77 id="_x0000_i1026"
  src="AVR_logo_blue.gif"></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;height:.75pt'>
  <td colspan=3 style='padding:.75pt .75pt .75pt .75pt;height:.75pt'
  background=blue.gif>
  <p class=MsoNormal><span style='font-size:1.0pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_21d9b7b08462661958c4d98529a1490d.html">lib_board</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_32ac5949c48a660d1bb9b798549f5eba.html">cc-adc</a>
  </div>
</div>
<div class="contents">
<h1>ccadc.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
CCADC module. 
<p>
Module for configuration and sampling with the Coulomb Counter ADC (CCADC).<p>
<dl class="user" compact><dt><b>Application note:</b></dt><dd>AVR474: SB202 Firmware user's guide.</dd></dl>
<dl class="user" compact><dt><b>Documentation</b></dt><dd>For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.html</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support email: <a href="mailto:avr@atmel.com">avr@atmel.com</a></dd></dl>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>5957 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>2009-08-27 19:38:17 +0800 (Thu, 27 Aug 2009) </dd></dl>
<br>
<p>
Copyright (c) 2009, Atmel Corporation All rights reserved.<p>
Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<p>
1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<p>
2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<p>
3. The name of ATMEL may not be used to endorse or promote products derived from this software without specific prior written permission.<p>
THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
<p>Definition in file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>
<code>#include &quot;<a class="el" href="common_8h-source.html">common.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="ccadc_8h-source.html">ccadc.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="watchdog_8h-source.html">watchdog.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for ccadc.c:</div>
<div class="dynsection">
<p><center><img src="ccadc_8c__incl.gif" border="0" usemap="#lib_board/cc-adc/ccadc.c_map" alt=""></center>
<map name="lib_board/cc-adc/ccadc.c_map">
<area shape="rect" href="common_8h.html" title="Common headerfile." alt="" coords="275,304,357,331"><area shape="rect" href="ccadc_8h.html" title="CCADC module header file." alt="" coords="435,80,501,107"><area shape="rect" href="watchdog_8h.html" title="Header file for Watchdog Timer peripheral module driver." alt="" coords="5,155,93,181"><area shape="rect" href="stdint_8h.html" title="stdint.h" alt="" coords="85,379,149,405"><area shape="rect" href="error_8h.html" title="error.h" alt="" coords="437,379,496,405"><area shape="rect" href="battery__pack__parameters_8h.html" title="Definition file for a smart battery pack." alt="" coords="231,155,409,181"><area shape="rect" href="sbs__commands_8h.html" title="Headerfile for sbs_commands.c." alt="" coords="80,229,203,256"><area shape="rect" href="vadc_8h.html" title="Headerfile for vadc_usage.c." alt="" coords="227,229,285,256"><area shape="rect" href="battery__protection_8h.html" title="Header file for Battery Protection peripheral module driver." alt="" coords="309,229,445,256"><area shape="rect" href="battery__current__monitoring_8h.html" title="Header file for CC&#45;ADC result processing firmware module." alt="" coords="469,229,656,256"><area shape="rect" href="crc16_8h.html" title="Header file for CRC16 functions." alt="" coords="85,304,149,331"></map>
</div>

<p>
<a href="ccadc_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">union &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="unionCCADC__conversionFlag__union.html">CCADC_conversionFlag_union</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">__interrupt void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#319babe7c0c366efb9fb6e3e088f61cf">CCADC_Acc_ISR</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CC-ADC Accumulated current conversion complete interrupt.  <a href="#319babe7c0c366efb9fb6e3e088f61cf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#a0713dd1fe379d8acea94e7f9844cb92">CCADC_CalculateAccOffset</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculates the accumulating conversion offset.  <a href="#a0713dd1fe379d8acea94e7f9844cb92"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#99e4ffa15714d365505a8e83f023bb23">CCADC_GetAccOffset</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the offset for the accumulating conversion.  <a href="#99e4ffa15714d365505a8e83f023bb23"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#a10e785327fcbf1bc692c30d790145b7">CCADC_GetAccResult</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns result of an CC-ADC Accumulated Conversion.  <a href="#a10e785327fcbf1bc692c30d790145b7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#1083b31150a28afe4293aa73edf0f1d2">CCADC_GetIccResult</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns result of an CC-ADC Instantaneous Conversion.  <a href="#1083b31150a28afe4293aa73edf0f1d2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#e043b3bc1105bbe1edaa56c75c6b85f7">CCADC_GetMode</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Provide information whether CC-ADC is in RCC mode of IC/ACC mode.  <a href="#e043b3bc1105bbe1edaa56c75c6b85f7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b">CCADC_GetPolarityChange</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if polarity was changed after last completed ACC conversion.  <a href="#059777fbbf56eeddb97a317a9301284b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#0b0c7df0d9cdfdbd2ed93dff245b123b">CCADC_GetRawAccOffset</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the raw offset for the accumulating conversion.  <a href="#0b0c7df0d9cdfdbd2ed93dff245b123b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">__interrupt void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#3fa4ec3a538dac0bef4b2cf919fd7c64">CCADC_Icc_ISR</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CC-ADC instant current conversion complete interrupt.  <a href="#3fa4ec3a538dac0bef4b2cf919fd7c64"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#d33fcbcc8cffde4e80167e91d4c4ee41">CCADC_Init</a> (<a class="el" href="ccadc_8h.html#caa912ea3f20deb736d340fbe97fff91">CCADC_AccConvPeriod_t</a> accConversionTime, <a class="el" href="ccadc_8h.html#f943993f53b8c0eb8775114f2578616d">CCADC_RccConvPeriod_t</a> rccSamplingInterval, <a class="el" href="stdint_8h.html#273cf69d639a59973b6019625df33e30">uint16_t</a> regularCurrentLevel)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configuration of the CC-ADC and Regular Current Level.  <a href="#d33fcbcc8cffde4e80167e91d4c4ee41"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4">CCADC_isAccResultReady</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to determine if a new CCADC accumulated current result is ready.  <a href="#e1fa828dd58f653f3beec1a90b27a3a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#9b1e8a8ca9c50eba50dd64939e9bea77">CCADC_isIccResultReady</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to determine if a new CCADC instant current result is ready.  <a href="#9b1e8a8ca9c50eba50dd64939e9bea77"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#2a12cd9bfb56a755f93254064f39cf84">CCADC_PolarityManager</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Controls when to alter the CC-ADC input polarity.  <a href="#2a12cd9bfb56a755f93254064f39cf84"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">__interrupt void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#b5bbcced66ff93991040f066c71614c7">CCADC_Rcc_ISR</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CC-ADC Regular current threshold passed interrupt.  <a href="#b5bbcced66ff93991040f066c71614c7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#afad5ab69f7a7df09fee8205f5c9a710">CCADC_SetMode</a> (<a class="el" href="ccadc_8h.html#f80ca771387453f6fbaa06717ce12afd">CCADC_modes_t</a> mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Selects mode of operation for the CC-ADC.  <a href="#afad5ab69f7a7df09fee8205f5c9a710"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">volatile <a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#0300c4054204e338c8e323a194e79cbf">CCADC_iccResult</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">union <a class="el" href="unionCCADC__conversionFlag__union.html">CCADC_conversionFlag_union</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="319babe7c0c366efb9fb6e3e088f61cf"></a><!-- doxytag: member="ccadc.c::CCADC_Acc_ISR" ref="319babe7c0c366efb9fb6e3e088f61cf" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__interrupt void CCADC_Acc_ISR           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
CC-ADC Accumulated current conversion complete interrupt. 
<p>

<p>
&lt; Wait for synchronization between clock domains before reading state 
<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00516">516</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c-source.html#l00068">CCADC_conversionFlag_union::accResultReady</a>, <a class="el" href="ccadc_8c-source.html#l00062">CCADC_accResult</a>, <a class="el" href="ccadc_8h-source.html#l00095">CCADC_IS_POLARITY_NEGATIVE</a>, <a class="el" href="ccadc_8c-source.html#l00269">CCADC_PolarityManager()</a>, <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, and <a class="el" href="ccadc_8c-source.html#l00071">CCADC_conversionFlag_union::polaritySwitchOccured</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00517"></a>00517 {
<a name="l00519"></a>00519     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00520"></a>00520     
<a name="l00521"></a>00521     <span class="keywordflow">if</span>( <a class="code" href="ccadc_8h.html#d1eb922358b1171dd7a7d1185180bf24">CCADC_IS_POLARITY_NEGATIVE</a>() )
<a name="l00522"></a>00522     {
<a name="l00523"></a>00523         <a class="code" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a> = - CADAC;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     <span class="keywordflow">else</span>
<a name="l00526"></a>00526     {
<a name="l00527"></a>00527         <a class="code" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a> = CADAC;
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529     
<a name="l00530"></a>00530 <span class="preprocessor">#ifdef COMPENSATE_FOR_ERROR_AFTER_POLARITY_SWITCH</span>
<a name="l00531"></a>00531 <span class="preprocessor"></span>    <span class="comment">// If polarityCounter is equal to 1, the current result stored in CCADC_accResults</span>
<a name="l00532"></a>00532     <span class="comment">// should be compensated because it's the first conversion after a polarity switch</span>
<a name="l00533"></a>00533     <span class="keywordflow">if</span>(<a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#5b8ac88e6198f8182a48b14608104e8c">polaritySwitchOccured</a>) {
<a name="l00534"></a>00534         <a class="code" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a> += (iccBeforeCadpolChange&gt;&gt;2);
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 <span class="preprocessor">#endif</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span>    
<a name="l00538"></a>00538     <a class="code" href="ccadc_8c.html#2a12cd9bfb56a755f93254064f39cf84" title="Controls when to alter the CC-ADC input polarity.">CCADC_PolarityManager</a>();
<a name="l00539"></a>00539     <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#f0642715524cb0c53f6daf6bdc01cc1b">accResultReady</a> = <span class="keyword">true</span>;
<a name="l00540"></a>00540 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="ccadc_8c_319babe7c0c366efb9fb6e3e088f61cf_cgraph.gif" border="0" usemap="#ccadc_8c_319babe7c0c366efb9fb6e3e088f61cf_cgraph_map" alt=""></center>
<map name="ccadc_8c_319babe7c0c366efb9fb6e3e088f61cf_cgraph_map">
<area shape="rect" href="ccadc_8c.html#2a12cd9bfb56a755f93254064f39cf84" title="Controls when to alter the CC&#45;ADC input polarity." alt="" coords="179,5,347,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="a0713dd1fe379d8acea94e7f9844cb92"></a><!-- doxytag: member="ccadc.c::CCADC_CalculateAccOffset" ref="a0713dd1fe379d8acea94e7f9844cb92" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CCADC_CalculateAccOffset           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Calculates the accumulating conversion offset. 
<p>
Waits until a polarity change occurs, then gathers values for each polarity and calculates the offset.<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>TODO: Will take all CPU except for interrupts, so communication etc will not work. Also the current is not sent to the CCGASG module at the moment, so this should only be run when very low currents.<p>
Even more important note: The current has to be constant when this function is run! Keeping the FETs disabled is the easiest solution. </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00427">427</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="battery__pack__parameters_8h-source.html#l00379">accOffset</a>, <a class="el" href="ccadc_8c-source.html#l00224">CCADC_GetAccResult()</a>, <a class="el" href="ccadc_8c-source.html#l00351">CCADC_GetPolarityChange()</a>, <a class="el" href="ccadc_8h-source.html#l00095">CCADC_IS_POLARITY_NEGATIVE</a>, <a class="el" href="ccadc_8c-source.html#l00310">CCADC_isAccResultReady()</a>, and <a class="el" href="watchdog_8h-source.html#l00085">WDT_ResetTimer</a>.</p>

<p>Referenced by <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <a class="code" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> average;
<a name="l00430"></a>00430     <a class="code" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> firstSampleAverage;
<a name="l00431"></a>00431     <a class="code" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> secondSampleAverage;
<a name="l00432"></a>00432     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> values;
<a name="l00433"></a>00433     
<a name="l00434"></a>00434     <span class="comment">// Wait for a polarity change</span>
<a name="l00435"></a>00435     <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion.">CCADC_GetPolarityChange</a>() ) {
<a name="l00436"></a>00436         <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready.">CCADC_isAccResultReady</a>() ) {};
<a name="l00437"></a>00437         <a class="code" href="watchdog_8h.html#e776b9716ca28065f698cc0cd37d21ab" title="Reset the Watchdog Timer.">WDT_ResetTimer</a>();
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439     <span class="comment">// Get polarity (wait for synchronization just in case)</span>
<a name="l00440"></a>00440     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00441"></a>00441     <span class="keywordtype">bool</span> firstSampleNegative = <a class="code" href="ccadc_8h.html#d1eb922358b1171dd7a7d1185180bf24">CCADC_IS_POLARITY_NEGATIVE</a>();
<a name="l00442"></a>00442     
<a name="l00443"></a>00443     <span class="comment">// Discard first reading after polarity change</span>
<a name="l00444"></a>00444     <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready.">CCADC_isAccResultReady</a>() ) {};
<a name="l00445"></a>00445     <a class="code" href="watchdog_8h.html#e776b9716ca28065f698cc0cd37d21ab" title="Reset the Watchdog Timer.">WDT_ResetTimer</a>();
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     <span class="comment">// Save each value until a new polarity change</span>
<a name="l00448"></a>00448     values = 0;
<a name="l00449"></a>00449     average = 0;
<a name="l00450"></a>00450     <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion.">CCADC_GetPolarityChange</a>() ) {
<a name="l00451"></a>00451         <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready.">CCADC_isAccResultReady</a>() ) {};
<a name="l00452"></a>00452         <a class="code" href="watchdog_8h.html#e776b9716ca28065f698cc0cd37d21ab" title="Reset the Watchdog Timer.">WDT_ResetTimer</a>();
<a name="l00453"></a>00453         average += <a class="code" href="ccadc_8c.html#a10e785327fcbf1bc692c30d790145b7" title="Returns result of an CC-ADC Accumulated Conversion.">CCADC_GetAccResult</a>();
<a name="l00454"></a>00454         ++values;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456     firstSampleAverage = average/values;
<a name="l00457"></a>00457     
<a name="l00458"></a>00458     <span class="comment">// Discard first reading after polarity change</span>
<a name="l00459"></a>00459     <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready.">CCADC_isAccResultReady</a>() ) {};
<a name="l00460"></a>00460     <a class="code" href="watchdog_8h.html#e776b9716ca28065f698cc0cd37d21ab" title="Reset the Watchdog Timer.">WDT_ResetTimer</a>();
<a name="l00461"></a>00461     
<a name="l00462"></a>00462     <span class="comment">// Save each value until a new polarity change</span>
<a name="l00463"></a>00463     values = 0;
<a name="l00464"></a>00464     average = 0;
<a name="l00465"></a>00465     <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion.">CCADC_GetPolarityChange</a>() ) {
<a name="l00466"></a>00466         <span class="keywordflow">while</span>( ! <a class="code" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready.">CCADC_isAccResultReady</a>() ) {};
<a name="l00467"></a>00467         <a class="code" href="watchdog_8h.html#e776b9716ca28065f698cc0cd37d21ab" title="Reset the Watchdog Timer.">WDT_ResetTimer</a>();
<a name="l00468"></a>00468         average += <a class="code" href="ccadc_8c.html#a10e785327fcbf1bc692c30d790145b7" title="Returns result of an CC-ADC Accumulated Conversion.">CCADC_GetAccResult</a>();
<a name="l00469"></a>00469         ++values;
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471     secondSampleAverage = average/values;
<a name="l00472"></a>00472     
<a name="l00473"></a>00473     <a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a> = (firstSampleAverage - secondSampleAverage) / 2;
<a name="l00474"></a>00474     <span class="keywordflow">if</span>(firstSampleNegative)  {
<a name="l00475"></a>00475         <a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a> = -<a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="ccadc_8c_a0713dd1fe379d8acea94e7f9844cb92_cgraph.gif" border="0" usemap="#ccadc_8c_a0713dd1fe379d8acea94e7f9844cb92_cgraph_map" alt=""></center>
<map name="ccadc_8c_a0713dd1fe379d8acea94e7f9844cb92_cgraph_map">
<area shape="rect" href="ccadc_8c.html#a10e785327fcbf1bc692c30d790145b7" title="Returns result of an CC&#45;ADC Accumulated Conversion." alt="" coords="252,5,407,32"><area shape="rect" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion." alt="" coords="239,56,420,83"><area shape="rect" href="ccadc_8c.html#e1fa828dd58f653f3beec1a90b27a3a4" title="Used to determine if a new CCADC accumulated current result is ready." alt="" coords="240,107,419,133"></map>
</div>

</div>
</div><p>
<a class="anchor" name="99e4ffa15714d365505a8e83f023bb23"></a><!-- doxytag: member="ccadc.c::CCADC_GetAccOffset" ref="99e4ffa15714d365505a8e83f023bb23" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> CCADC_GetAccOffset           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the offset for the accumulating conversion. 
<p>
Checks the polarity of last conversion, so that the values returned from this function can be directly added to result of last conversion to get a offset calibrated result.<p>
If accOffset not is calculated (it is 32767), zero is returned<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Value that should be added to last current. </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00392">392</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="battery__pack__parameters_8h-source.html#l00379">accOffset</a>, <a class="el" href="ccadc_8c-source.html#l00351">CCADC_GetPolarityChange()</a>, and <a class="el" href="ccadc_8h-source.html#l00095">CCADC_IS_POLARITY_NEGATIVE</a>.</p>

<p>Referenced by <a class="el" href="battery__current__monitoring_8c-source.html#l00077">BATTCUR_StoreCurrent()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00393"></a>00393 {
<a name="l00394"></a>00394     <span class="keywordflow">if</span>(<a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a> == 32767) {
<a name="l00395"></a>00395         <span class="keywordflow">return</span> 0;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     <span class="keywordtype">bool</span> polChange = <a class="code" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion.">CCADC_GetPolarityChange</a>();
<a name="l00398"></a>00398     <span class="keywordflow">if</span> ( <a class="code" href="ccadc_8h.html#d1eb922358b1171dd7a7d1185180bf24">CCADC_IS_POLARITY_NEGATIVE</a>() ) {
<a name="l00399"></a>00399         <span class="keywordflow">if</span> ( polChange ) {
<a name="l00400"></a>00400             <span class="keywordflow">return</span> -<a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00401"></a>00401         } <span class="keywordflow">else</span> {
<a name="l00402"></a>00402             <span class="keywordflow">return</span> <a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404     } <span class="keywordflow">else</span> {
<a name="l00405"></a>00405         <span class="keywordflow">if</span>( polChange ) {
<a name="l00406"></a>00406             <span class="keywordflow">return</span> <a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00407"></a>00407         } <span class="keywordflow">else</span> {
<a name="l00408"></a>00408             <span class="keywordflow">return</span> -<a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="ccadc_8c_99e4ffa15714d365505a8e83f023bb23_cgraph.gif" border="0" usemap="#ccadc_8c_99e4ffa15714d365505a8e83f023bb23_cgraph_map" alt=""></center>
<map name="ccadc_8c_99e4ffa15714d365505a8e83f023bb23_cgraph_map">
<area shape="rect" href="ccadc_8c.html#059777fbbf56eeddb97a317a9301284b" title="Check if polarity was changed after last completed ACC conversion." alt="" coords="207,5,388,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="a10e785327fcbf1bc692c30d790145b7"></a><!-- doxytag: member="ccadc.c::CCADC_GetAccResult" ref="a10e785327fcbf1bc692c30d790145b7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a> CCADC_GetAccResult           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns result of an CC-ADC Accumulated Conversion. 
<p>
Returns the 18 bit signed result of an Accumulated Conversion as signed 32-bit. The result is scaled so to use a 24.8 signed fixed point format before it is returned.<p>
NOTE that the Bandgap voltage refence must be enabled and calibrated to used the CC-ADC.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Latest CCADC ACC result is returned in a 24.8 signed fixed point format </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00224">224</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c-source.html#l00062">CCADC_accResult</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00427">CCADC_CalculateAccOffset()</a>, and <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00225"></a>00225 {
<a name="l00226"></a>00226     <a class="code" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a> result;
<a name="l00227"></a>00227     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> interruptState = __save_interrupt();
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     __disable_interrupt();
<a name="l00230"></a>00230     result = <a class="code" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a>;
<a name="l00231"></a>00231     __restore_interrupt(interruptState);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="keywordflow">return</span> result;
<a name="l00234"></a>00234 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1083b31150a28afe4293aa73edf0f1d2"></a><!-- doxytag: member="ccadc.c::CCADC_GetIccResult" ref="1083b31150a28afe4293aa73edf0f1d2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a> CCADC_GetIccResult           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns result of an CC-ADC Instantaneous Conversion. 
<p>
Returns the 13 bit signed result of an Instantaneous Conversion as signed 16-bit<p>
NOTE that the Bandgap voltage refence must be enabled and calibrated to used the CC-ADC<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Latest CCADC ICC result. </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00247">247</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c-source.html#l00063">CCADC_iccResult</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <a class="code" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> result;
<a name="l00250"></a>00250     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> interruptState = __save_interrupt();
<a name="l00251"></a>00251     
<a name="l00252"></a>00252     __disable_interrupt();
<a name="l00253"></a>00253     result = <a class="code" href="ccadc_8c.html#0300c4054204e338c8e323a194e79cbf">CCADC_iccResult</a>;
<a name="l00254"></a>00254     __restore_interrupt(interruptState);
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     <span class="keywordflow">return</span> (<a class="code" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a>)(result) * (1&lt;&lt;5); <span class="comment">// Scale the 13-bit Icc result to 18-bit like the Acc result.</span>
<a name="l00257"></a>00257 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e043b3bc1105bbe1edaa56c75c6b85f7"></a><!-- doxytag: member="ccadc.c::CCADC_GetMode" ref="e043b3bc1105bbe1edaa56c75c6b85f7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> CCADC_GetMode           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Provide information whether CC-ADC is in RCC mode of IC/ACC mode. 
<p>
NOTE that the Bandgap voltage refence must be enabled and calibrated to used the CC-ADC<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>mode [CCADC_RCC, CCADC_IAC] </dd></dl>

<p>
&lt; Wait for synchronization between clock domains before reading state 
<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00198">198</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8h-source.html#l00068">CCADC_IAC</a>, and <a class="el" href="ccadc_8h-source.html#l00071">CCADC_RCC</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00199"></a>00199 {
<a name="l00201"></a>00201     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">if</span>( CADCSRA &amp; (1&lt;&lt;CADSE) )
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         <span class="keywordflow">return</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c096f73d4f967bb990e0fe80241a5ee34c98" title="Regular Current Condition is enabled - Note that accumulator is disabled and cleared...">CCADC_RCC</a>;
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207     <span class="keywordflow">else</span>
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209         <span class="keywordflow">return</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c096f594229f4c402935a0209656ee46875e" title="CC_ADC is enabled and both Instantaneous Current and Accumulated Current Conversions...">CCADC_IAC</a>;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="059777fbbf56eeddb97a317a9301284b"></a><!-- doxytag: member="ccadc.c::CCADC_GetPolarityChange" ref="059777fbbf56eeddb97a317a9301284b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CCADC_GetPolarityChange           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check if polarity was changed after last completed ACC conversion. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>Polarity was changed after last completed ACC conversion </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>Polarity was not changed after last ACC conversion </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00351">351</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, and <a class="el" href="ccadc_8c-source.html#l00071">CCADC_conversionFlag_union::polaritySwitchOccured</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00427">CCADC_CalculateAccOffset()</a>, and <a class="el" href="ccadc_8c-source.html#l00392">CCADC_GetAccOffset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00352"></a>00352 {
<a name="l00353"></a>00353     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> interruptState = __save_interrupt();
<a name="l00354"></a>00354     __disable_interrupt();
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="keywordtype">bool</span> flagState = <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#5b8ac88e6198f8182a48b14608104e8c">polaritySwitchOccured</a>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     __restore_interrupt( interruptState );
<a name="l00359"></a>00359     
<a name="l00360"></a>00360     <span class="keywordflow">return</span> flagState;
<a name="l00361"></a>00361 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0b0c7df0d9cdfdbd2ed93dff245b123b"></a><!-- doxytag: member="ccadc.c::CCADC_GetRawAccOffset" ref="0b0c7df0d9cdfdbd2ed93dff245b123b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> CCADC_GetRawAccOffset           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the raw offset for the accumulating conversion. 
<p>
Add this to results from negative polarity and remove from positive polarity<p>
<dl class="note" compact><dt><b>Note:</b></dt><dd>This will return 32767 if the offset hasn't been calculated</dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Offset for the accumulating conversion </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00374">374</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="battery__pack__parameters_8h-source.html#l00379">accOffset</a>.</p>

<p>Referenced by <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <span class="keywordflow">return</span> <a class="code" href="battery__pack__parameters_8h.html#8f90e2defc950bec584316a620378e2e">accOffset</a>;
<a name="l00377"></a>00377 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3fa4ec3a538dac0bef4b2cf919fd7c64"></a><!-- doxytag: member="ccadc.c::CCADC_Icc_ISR" ref="3fa4ec3a538dac0bef4b2cf919fd7c64" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__interrupt void CCADC_Icc_ISR           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
CC-ADC instant current conversion complete interrupt. 
<p>

<p>
&lt; Wait for synchronization between clock domains before reading state 
<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00484">484</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c-source.html#l00063">CCADC_iccResult</a>, <a class="el" href="ccadc_8h-source.html#l00095">CCADC_IS_POLARITY_NEGATIVE</a>, <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, and <a class="el" href="ccadc_8c-source.html#l00069">CCADC_conversionFlag_union::iccResultReady</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00485"></a>00485 {
<a name="l00487"></a>00487     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00488"></a>00488     
<a name="l00489"></a>00489     <span class="keywordflow">if</span>( <a class="code" href="ccadc_8h.html#d1eb922358b1171dd7a7d1185180bf24">CCADC_IS_POLARITY_NEGATIVE</a>() )
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491         <a class="code" href="ccadc_8c.html#0300c4054204e338c8e323a194e79cbf">CCADC_iccResult</a> = -CADIC;
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493     <span class="keywordflow">else</span>
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495         <a class="code" href="ccadc_8c.html#0300c4054204e338c8e323a194e79cbf">CCADC_iccResult</a> = CADIC;
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497     
<a name="l00498"></a>00498     <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#14cc7cb6778d06cdcdf58038b9f71e2a">iccResultReady</a> = <span class="keyword">true</span>;
<a name="l00499"></a>00499 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d33fcbcc8cffde4e80167e91d4c4ee41"></a><!-- doxytag: member="ccadc.c::CCADC_Init" ref="d33fcbcc8cffde4e80167e91d4c4ee41" args="(CCADC_AccConvPeriod_t accConversionTime, CCADC_RccConvPeriod_t rccSamplingInterval, uint16_t regularCurrentLevel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CCADC_Init           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ccadc_8h.html#caa912ea3f20deb736d340fbe97fff91">CCADC_AccConvPeriod_t</a>&nbsp;</td>
          <td class="paramname"> <em>accConversionTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ccadc_8h.html#f943993f53b8c0eb8775114f2578616d">CCADC_RccConvPeriod_t</a>&nbsp;</td>
          <td class="paramname"> <em>rccSamplingInterval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="stdint_8h.html#273cf69d639a59973b6019625df33e30">uint16_t</a>&nbsp;</td>
          <td class="paramname"> <em>regularCurrentLevel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Configuration of the CC-ADC and Regular Current Level. 
<p>
Sets the conversion time for both accumulating and regular current measuring, as well as regular current level.<p>
Note that the CC-ADC is turned off if it was running, and is not started again<p>
NOTE that the Bandgap voltage refence must be enabled and calibrated to used the CC-ADC<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>accConversionTime</em>&nbsp;</td><td>[ACCT_128, ACCT_256, ACCT_512, ACCT_1024] </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rccSamplingInterval</em>&nbsp;</td><td>[RSI_256, RSI_512, RSI_1024, RSI_2048] </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>regularCurrentLevel</em>&nbsp;</td><td>Given in milliAmps</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>void</em>&nbsp;</td><td></td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00097">97</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="battery__current__monitoring_8c-source.html#l00303">BATTCUR_mA2RccTicks()</a>, and <a class="el" href="ccadc_8h-source.html#l00091">CCADC_POLARITY_POS</a>.</p>

<p>Referenced by <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00098"></a>00098 {
<a name="l00099"></a>00099     <span class="comment">// Wait until CC-ADC is ready for configuration change.</span>
<a name="l00100"></a>00100     <span class="comment">//(wait for synchronization between clock domains to be completed since previous change).</span>
<a name="l00101"></a>00101     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="preprocessor">#if (CCADC_VOLTREF == CCADC_VOLTREF_110mV)</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>    <span class="comment">//Enable voltage scaling on reference</span>
<a name="l00105"></a>00105     CADCSRC |= (1&lt;&lt;CADVSE);
<a name="l00106"></a>00106 <span class="preprocessor">#elif (CCADC_VOLTREF == CCADC_VOLTREF_220mV)</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>    <span class="comment">//Disable voltage scaling on reference</span>
<a name="l00108"></a>00108     CADCSRC &amp;= ~(1&lt;&lt;CADVSE);
<a name="l00109"></a>00109 <span class="preprocessor">#else</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#error CCADC_VOLTREF must be either CCADC_VOLTREF_220mV or CCADC_VOLTREF_110mV</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>    
<a name="l00113"></a>00113     <span class="comment">// Wait again</span>
<a name="l00114"></a>00114     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <span class="comment">// Set Regular current detection level.</span>
<a name="l00117"></a>00117     CADRCC = <a class="code" href="battery__current__monitoring_8c.html#490aa68cdebeff1cd6ca0f27c039139d" title="Convert mA to Rcc CCADC ticks.">BATTCUR_mA2RccTicks</a>(regularCurrentLevel);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="comment">// Wait again</span>
<a name="l00120"></a>00120     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00121"></a>00121     
<a name="l00122"></a>00122     <span class="comment">// Select CC-ADC Conversion Time, Current Sampling Interval and polarity bit</span>
<a name="l00123"></a>00123     <span class="comment">// Note: turns off CC-ADC if it was running</span>
<a name="l00124"></a>00124     CADCSRA = ((<a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)accConversionTime) | ((<a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>)rccSamplingInterval) | (<a class="code" href="ccadc_8h.html#10729cb0c531eb74eaa4e606a696df1d">CCADC_POLARITY_POS</a>);
<a name="l00125"></a>00125 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="ccadc_8c_d33fcbcc8cffde4e80167e91d4c4ee41_cgraph.gif" border="0" usemap="#ccadc_8c_d33fcbcc8cffde4e80167e91d4c4ee41_cgraph_map" alt=""></center>
<map name="ccadc_8c_d33fcbcc8cffde4e80167e91d4c4ee41_cgraph_map">
<area shape="rect" href="battery__current__monitoring_8c.html#490aa68cdebeff1cd6ca0f27c039139d" title="Convert mA to Rcc CCADC ticks." alt="" coords="144,5,312,32"><area shape="rect" href="battery__current__monitoring_8c.html#90ab35d451c37cb0d641b5f037598441" title="Convert mA to CCADC tick." alt="" coords="361,5,505,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="e1fa828dd58f653f3beec1a90b27a3a4"></a><!-- doxytag: member="ccadc.c::CCADC_isAccResultReady" ref="e1fa828dd58f653f3beec1a90b27a3a4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CCADC_isAccResultReady           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Used to determine if a new CCADC accumulated current result is ready. 
<p>
Since the internal status flag is also accessed by the interrupt, it is protected by disabling the global interrupt while accessing it.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns true is new result is ready, otherwise false. </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00310">310</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c-source.html#l00068">CCADC_conversionFlag_union::accResultReady</a>, and <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00427">CCADC_CalculateAccOffset()</a>, and <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00311"></a>00311 {
<a name="l00312"></a>00312     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> interruptState = __save_interrupt();
<a name="l00313"></a>00313     __disable_interrupt();
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordtype">bool</span> flagState = <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#f0642715524cb0c53f6daf6bdc01cc1b">accResultReady</a>;
<a name="l00316"></a>00316     <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#f0642715524cb0c53f6daf6bdc01cc1b">accResultReady</a> = <span class="keyword">false</span>;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     __restore_interrupt( interruptState );
<a name="l00319"></a>00319     
<a name="l00320"></a>00320     <span class="keywordflow">return</span> flagState;
<a name="l00321"></a>00321 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9b1e8a8ca9c50eba50dd64939e9bea77"></a><!-- doxytag: member="ccadc.c::CCADC_isIccResultReady" ref="9b1e8a8ca9c50eba50dd64939e9bea77" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CCADC_isIccResultReady           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Used to determine if a new CCADC instant current result is ready. 
<p>
Since the internal status flag is also accessed by the interrupt, it is protected by disabling the global interrupt while accessing it.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Returns true is new result is ready, otherwise false. </dd></dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00331">331</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, and <a class="el" href="ccadc_8c-source.html#l00069">CCADC_conversionFlag_union::iccResultReady</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00332"></a>00332 {
<a name="l00333"></a>00333     <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> interruptState = __save_interrupt();
<a name="l00334"></a>00334     __disable_interrupt();
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordtype">bool</span> flagState = <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#14cc7cb6778d06cdcdf58038b9f71e2a">iccResultReady</a>;
<a name="l00337"></a>00337     <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#14cc7cb6778d06cdcdf58038b9f71e2a">iccResultReady</a> = <span class="keyword">false</span>;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     __restore_interrupt( interruptState );
<a name="l00340"></a>00340     
<a name="l00341"></a>00341     <span class="keywordflow">return</span> flagState;
<a name="l00342"></a>00342 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2a12cd9bfb56a755f93254064f39cf84"></a><!-- doxytag: member="ccadc.c::CCADC_PolarityManager" ref="2a12cd9bfb56a755f93254064f39cf84" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void CCADC_PolarityManager           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Controls when to alter the CC-ADC input polarity. 
<p>
Changes the CC-ADC input polarity every <a class="el" href="battery__pack__parameters_8h.html#1f2a2a2c08864c8c1c6e0cd035ceb569">CONVERSION_COUNT</a> conversion. Since this should be done as soon after the conversion has completed as possible this function is embedded in the ACC conversion complete interrupt rutine. It should not be called from elsewere, and is therefore static/local file scope only. 
<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00269">269</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8h-source.html#l00095">CCADC_IS_POLARITY_NEGATIVE</a>, <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, <a class="el" href="battery__pack__parameters_8h-source.html#l00243">CONVERSION_COUNT</a>, and <a class="el" href="ccadc_8c-source.html#l00071">CCADC_conversionFlag_union::polaritySwitchOccured</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00516">CCADC_Acc_ISR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271     <span class="keyword">static</span> <a class="code" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> polarityCounter = <a class="code" href="battery__pack__parameters_8h.html#1f2a2a2c08864c8c1c6e0cd035ceb569" title="Number of conversions to run before changing polarity of the CC-ADC.">CONVERSION_COUNT</a>;
<a name="l00272"></a>00272     
<a name="l00273"></a>00273     polarityCounter--;
<a name="l00274"></a>00274     
<a name="l00275"></a>00275     <span class="keywordflow">if</span>(polarityCounter == 0)
<a name="l00276"></a>00276     {
<a name="l00277"></a>00277         <span class="comment">// Save ICC reading from before the CADPOL is changed</span>
<a name="l00278"></a>00278         <span class="comment">// This is used to compensate for that the first icc (and therefore also</span>
<a name="l00279"></a>00279         <span class="comment">// acc) readings are wrong after a polarity change.</span>
<a name="l00280"></a>00280 <span class="preprocessor">#ifdef COMPENSATE_FOR_ERROR_AFTER_POLARITY_SWITCH   </span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>        {
<a name="l00282"></a>00282             <span class="keywordflow">if</span>( <a class="code" href="ccadc_8h.html#d1eb922358b1171dd7a7d1185180bf24">CCADC_IS_POLARITY_NEGATIVE</a>() )
<a name="l00283"></a>00283             {   
<a name="l00284"></a>00284                 iccBeforeCadpolChange = -CADIC;
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286             <span class="keywordflow">else</span>
<a name="l00287"></a>00287             {
<a name="l00288"></a>00288                 iccBeforeCadpolChange = CADIC;
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291 <span class="preprocessor">#endif</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>        
<a name="l00293"></a>00293         CADCSRA ^= (1&lt;&lt;CADPOL);
<a name="l00294"></a>00294         polarityCounter = <a class="code" href="battery__pack__parameters_8h.html#1f2a2a2c08864c8c1c6e0cd035ceb569" title="Number of conversions to run before changing polarity of the CC-ADC.">CONVERSION_COUNT</a>;
<a name="l00295"></a>00295         <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#5b8ac88e6198f8182a48b14608104e8c">polaritySwitchOccured</a> = <span class="keyword">true</span>;
<a name="l00296"></a>00296         
<a name="l00297"></a>00297     } <span class="keywordflow">else</span> {
<a name="l00298"></a>00298         <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#5b8ac88e6198f8182a48b14608104e8c">polaritySwitchOccured</a> = <span class="keyword">false</span>;
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b5bbcced66ff93991040f066c71614c7"></a><!-- doxytag: member="ccadc.c::CCADC_Rcc_ISR" ref="b5bbcced66ff93991040f066c71614c7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__interrupt void CCADC_Rcc_ISR           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
CC-ADC Regular current threshold passed interrupt. 
<p>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00506">506</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>, and <a class="el" href="ccadc_8c-source.html#l00070">CCADC_conversionFlag_union::regularCurrentDetected</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00507"></a>00507 {
<a name="l00508"></a>00508     <a class="code" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>.<a class="code" href="unionCCADC__conversionFlag__union.html#b5b200878d2010f4e91f1f29df519110">regularCurrentDetected</a> = <span class="keyword">true</span>;
<a name="l00509"></a>00509 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="afad5ab69f7a7df09fee8205f5c9a710"></a><!-- doxytag: member="ccadc.c::CCADC_SetMode" ref="afad5ab69f7a7df09fee8205f5c9a710" args="(CCADC_modes_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CCADC_SetMode           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ccadc_8h.html#f80ca771387453f6fbaa06717ce12afd">CCADC_modes_t</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Selects mode of operation for the CC-ADC. 
<p>
Select between<ul>
<li>CCADC_DISABLE (To disable the CC-ADC, and disable and clear interrupts).</li><li>CCADC_IAC (CC_ADC is enabled and both Instantaneous and Accumulated Conversions generate interrupts).</li><li>CCADC_IC (CC_ADC is enabled and Instantaneous Conversions generate interrupts).</li><li>CCADC_ACC (CC_ADC is enabled and Instantaneous Conversions generate interrupts).</li><li>CCADC_RCC (Regular Current Condition is enabled - Note that accumulator is cleared)</li></ul>
<p>
Note that the enabling and disabling does _not_ modify the configuration of CC-ADC. It only enable and disable the mode and interrupts.<p>
NOTE that the Bandgap voltage refence must be enabled and calibrated to used the CC-ADC<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Which mode to set the CCADC to </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00147">147</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>References <a class="el" href="ccadc_8h-source.html#l00070">CCADC_ACC</a>, <a class="el" href="ccadc_8h-source.html#l00067">CCADC_DISABLE</a>, <a class="el" href="ccadc_8h-source.html#l00068">CCADC_IAC</a>, <a class="el" href="ccadc_8h-source.html#l00069">CCADC_ICC</a>, and <a class="el" href="ccadc_8h-source.html#l00071">CCADC_RCC</a>.</p>

<p>Referenced by <a class="el" href="main_8c-source.html#l00187">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
<a name="l00149"></a>00149     <span class="comment">// Wait for synchronization between clock domains before initiating write</span>
<a name="l00150"></a>00150     <span class="keywordflow">while</span>( CADCSRA &amp; (1&lt;&lt;CADUB) ){};
<a name="l00151"></a>00151     
<a name="l00152"></a>00152     <span class="keywordflow">switch</span>( mode )
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154     <span class="keywordflow">case</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c0965af6887a9dae07d7c084b6e7f05634da" title="To disable the CC-ADC, and disable and clear interrupts.">CCADC_DISABLE</a>:
<a name="l00155"></a>00155         <span class="comment">// Disable CC-ADC and disable interrupts (and clear pending interrupts).</span>
<a name="l00156"></a>00156         CADCSRA = CADCSRA &amp; ~( (1&lt;&lt;CADEN) | (1&lt;&lt;CADSE) );
<a name="l00157"></a>00157         CADCSRB = (0&lt;&lt;CADACIE) | (0&lt;&lt;CADRCIE) | (0&lt;&lt;CADICIE) | (1&lt;&lt;CADACIF) | (1&lt;&lt;CADRCIF) | (1&lt;&lt;CADICIF);
<a name="l00158"></a>00158         <span class="keywordflow">break</span>;
<a name="l00159"></a>00159         
<a name="l00160"></a>00160     <span class="keywordflow">case</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c096f594229f4c402935a0209656ee46875e" title="CC_ADC is enabled and both Instantaneous Current and Accumulated Current Conversions...">CCADC_IAC</a>:
<a name="l00161"></a>00161         <span class="comment">// Enable CC-ADC with both ICC and ACC interrupts running (and clear pending interrupts).</span>
<a name="l00162"></a>00162         CADCSRA = ( CADCSRA &amp; ~(1&lt;&lt;CADSE) ) | (1&lt;&lt;CADEN);
<a name="l00163"></a>00163         CADCSRB = (1&lt;&lt;CADACIE) | (0&lt;&lt;CADRCIE) | (1&lt;&lt;CADICIE) | (1&lt;&lt;CADACIF) | (1&lt;&lt;CADRCIF) | (1&lt;&lt;CADICIF);
<a name="l00164"></a>00164         <span class="keywordflow">break</span>;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="keywordflow">case</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c096bc5ef5c08a6cf3d228a32433b4410fa3" title="CC_ADC is enabled and Instantaneous Current Conversions generate interrupts.">CCADC_ICC</a>:
<a name="l00167"></a>00167         <span class="comment">// Enable CC-ADC with ICC interrupt running  (and clear pending interrupts).</span>
<a name="l00168"></a>00168         CADCSRA = ( CADCSRA &amp; ~(1&lt;&lt;CADSE) ) | (1&lt;&lt;CADEN);
<a name="l00169"></a>00169         CADCSRB = (0&lt;&lt;CADACIE) | (0&lt;&lt;CADRCIE) | (1&lt;&lt;CADICIE) | (1&lt;&lt;CADACIF) | (1&lt;&lt;CADRCIF) | (1&lt;&lt;CADICIF);
<a name="l00170"></a>00170         <span class="keywordflow">break</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">case</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c09605dbfa432ea2f1224b5c6b499b58a2a5" title="CC_ADC is enabled and Accumulated Current Conversions generate interrupts.">CCADC_ACC</a>:
<a name="l00173"></a>00173         <span class="comment">// Enable CC-ADC with ACC interrupt running  (and clear pending interrupts).</span>
<a name="l00174"></a>00174         CADCSRA = ( CADCSRA &amp; ~(1&lt;&lt;CADSE) ) | (1&lt;&lt;CADEN);
<a name="l00175"></a>00175         CADCSRB = (1&lt;&lt;CADACIE) | (0&lt;&lt;CADRCIE) | (0&lt;&lt;CADICIE) | (1&lt;&lt;CADACIF) | (1&lt;&lt;CADRCIF) | (1&lt;&lt;CADICIF);
<a name="l00176"></a>00176         <span class="keywordflow">break</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="keywordflow">case</span> <a class="code" href="ccadc_8h.html#8e4f515e173ca5bf4c0f461ea298c096f73d4f967bb990e0fe80241a5ee34c98" title="Regular Current Condition is enabled - Note that accumulator is disabled and cleared...">CCADC_RCC</a>:
<a name="l00179"></a>00179         <span class="comment">// Enable CC-ADC with RCC and ICC interrupts running (ICC due to RCC unable to wake up device from power save).</span>
<a name="l00180"></a>00180         CADCSRA = CADCSRA | (1&lt;&lt;CADSE) | (1&lt;&lt;CADEN);
<a name="l00181"></a>00181         CADCSRB = (0&lt;&lt;CADACIE) | (1&lt;&lt;CADRCIE) | (1&lt;&lt;CADICIE) | (1&lt;&lt;CADACIF) | (1&lt;&lt;CADRCIF) | (1&lt;&lt;CADICIF);
<a name="l00182"></a>00182         <span class="keywordflow">break</span>;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="keywordflow">default</span>:
<a name="l00185"></a>00185         <span class="keywordflow">break</span>;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="583bca4465e725be7dc8775df92a7920"></a><!-- doxytag: member="ccadc.c::CCADC_accResult" ref="583bca4465e725be7dc8775df92a7920" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="stdint_8h.html#2ba621978a511250f7250fb10e05ffbe">int32_t</a> <a class="el" href="ccadc_8c.html#583bca4465e725be7dc8775df92a7920">CCADC_accResult</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00062">62</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00516">CCADC_Acc_ISR()</a>, and <a class="el" href="ccadc_8c-source.html#l00224">CCADC_GetAccResult()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0300c4054204e338c8e323a194e79cbf"></a><!-- doxytag: member="ccadc.c::CCADC_iccResult" ref="0300c4054204e338c8e323a194e79cbf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="stdint_8h.html#269259c924dce846340ddbb810db2e3c">int16_t</a> <a class="el" href="ccadc_8c.html#0300c4054204e338c8e323a194e79cbf">CCADC_iccResult</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="ccadc_8c-source.html#l00063">63</a> of file <a class="el" href="ccadc_8c-source.html">ccadc.c</a>.</p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00247">CCADC_GetIccResult()</a>, and <a class="el" href="ccadc_8c-source.html#l00484">CCADC_Icc_ISR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c6ddb12710e6f11d0474945cd1baeb3b"></a><!-- doxytag: member="ccadc.c::CCADC_statusFlags" ref="c6ddb12710e6f11d0474945cd1baeb3b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union <a class="el" href="unionCCADC__conversionFlag__union.html">CCADC_conversionFlag_union</a> <a class="el" href="ccadc_8c.html#c6ddb12710e6f11d0474945cd1baeb3b">CCADC_statusFlags</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="ccadc_8c-source.html#l00516">CCADC_Acc_ISR()</a>, <a class="el" href="ccadc_8c-source.html#l00351">CCADC_GetPolarityChange()</a>, <a class="el" href="ccadc_8c-source.html#l00484">CCADC_Icc_ISR()</a>, <a class="el" href="ccadc_8c-source.html#l00310">CCADC_isAccResultReady()</a>, <a class="el" href="ccadc_8c-source.html#l00331">CCADC_isIccResultReady()</a>, <a class="el" href="ccadc_8c-source.html#l00269">CCADC_PolarityManager()</a>, and <a class="el" href="ccadc_8c-source.html#l00506">CCADC_Rcc_ISR()</a>.</p>

</div>
</div><p>
</div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Wed Aug 4 11:00:31 2010 for AVR474 Firmware User's Guide for SB202 by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.6</small></address>
    </td>
  </tr>

</table>
