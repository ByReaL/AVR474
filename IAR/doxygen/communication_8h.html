<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="atmel-header_files/filelist.xml">
<link rel=Edit-Time-Data href="atmel-header_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>@DOC_TITLE@</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>ping.zhou</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>ping.zhou</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Created>2010-08-04T02:58:00Z</o:Created>
  <o:LastSaved>2010-08-04T02:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>51</o:Words>
  <o:Characters>297</o:Characters>
  <o:Company>Atmel</o:Company>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>347</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<link rel=Stylesheet type="text/css" media=all href="doxygen.css">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellpadding=0 width="100%"
 style='width:100.0%;mso-cellspacing:1.5pt;background:white'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com"><span style='text-decoration:none;
  text-underline:none'><img border=0 width=109 height=50 id="_x0000_i1025"
  src=atmel.jpg></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span class=SpellE><strong><span style='font-size:24.0pt;
  font-family:Helvetica;color:black'>SmartBattery</span></strong></span><strong><span
  style='font-size:24.0pt;font-family:Helvetica;color:black'> Device
  Application Note</span></strong></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com/products/AVR"><span style='text-decoration:
  none;text-underline:none'><img border=0 width=138 height=77 id="_x0000_i1026"
  src="AVR_logo_blue.gif"></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;height:.75pt'>
  <td colspan=3 style='padding:.75pt .75pt .75pt .75pt;height:.75pt'
  background=blue.gif>
  <p class=MsoNormal><span style='font-size:1.0pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_29ae905079a6eb1b30b29288f24757bc.html">lib_mcu</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_37e9098495dcc10ac45fd55bc295899d.html">communication</a>
  </div>
</div>
<div class="contents">
<h1>communication.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the Communication definitions. 
<p>
<dl class="user" compact><dt><b>Application note:</b></dt><dd>AVR456: SB201 HVA one two cell smart battery firmware</dd></dl>
<dl class="user" compact><dt><b>Documentation:</b></dt><dd>For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.html</dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support email: <a href="mailto:avr@atmel.com">avr@atmel.com</a> <br>
 Original author: <br>
</dd></dl>
<dl class="rcs" compact><dt><b>Name</b></dt><dd></dd></dl>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>5627 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>2009-05-15 14:49:21 +0800 (Fri, 15 May 2009) </dd></dl>
<br>
<p>
Copyright (c) 2006, Atmel Corporation All rights reserved.<p>
Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:<p>
1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.<p>
2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.<p>
3. The name of ATMEL may not be used to endorse or promote products derived from this software without specific prior written permission.<p>
THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
<p>Definition in file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

<p>
<code>#include &quot;SBS_commands.h&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for communication.h:</div>
<div class="dynsection">
<p><center><img src="communication_8h__incl.gif" border="0" usemap="#lib_mcu/communication/communication.h_map" alt=""></center>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="communication_8h__dep__incl.gif" border="0" usemap="#lib_mcu/communication/communication.hdep_map" alt=""></center>
<map name="lib_mcu/communication/communication.hdep_map">
<area shape="rect" href="communication_8c.html" title="The communication file reads a command from the SMB bus and sends r/w, data and length..." alt="" coords="5,80,267,107"></map>
</div>

<p>
<a href="communication_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#1d5960c341cd7b2473003746f892a2e3">ALL_GROUP</a>&nbsp;&nbsp;&nbsp;'A'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#94d63e531eff73dc6747af91e974bdd6">BLOCK_CDE_POS</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#1d737b9dfdab54c4a9ae6c4100bab71e">BLOCK_SIZE_POS</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#ef97e91fe131cdda36c51332ff6ac261">CDE_POS</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#58dd4165844424cf00b762f0cc85c4a2">CHARGER</a>&nbsp;&nbsp;&nbsp;'C'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#101b8f769b32df10518a960c05f0010d">COMM_ACK</a>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#43bb5d11c19dcc66897d32bc67dfadb8">COMM_NACK</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#c23a924aa04ddcf6d90e18ccfc1e27aa">DATA_LENGTH_POS</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#70bac867ff718b68d5017d9ccebfa812">DB101_DISPLAY</a>&nbsp;&nbsp;&nbsp;'D'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#9614fa361339d5d83b4e3792b3d19682">ELECTRONIC_LOAD</a>&nbsp;&nbsp;&nbsp;'E'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#9a07396be342a97aabe7ec43ce63055d">FIRST_DATA_POS</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#50a2ff74b7c5f0e436d38978399043c5">FROM_POS</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#4ee9639c356507c268badf70158dd745">MAIN_CONTROLLER</a>&nbsp;&nbsp;&nbsp;'M'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#cf44c6363fce11e480dbb2f3b60ed2cb">MSK_RW_BIT_CDE</a>&nbsp;&nbsp;&nbsp;0x7F</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#3bc1c582723236e7052bd77cc458a098">PC_USB</a>&nbsp;&nbsp;&nbsp;'P'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#75189763dbbb96aa3f1e34262bab6382">SBS_READ</a>&nbsp;&nbsp;&nbsp;(0x80)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#d5500c9b9dd285eaa77e28413d7258df">SBS_WRITE</a>&nbsp;&nbsp;&nbsp;(0x00)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#ec97336349161e762ff43396753223f2">SMART_BATTERY</a>&nbsp;&nbsp;&nbsp;'S'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#9ac82e856c7683e23553431e5224d5f4">SYNC</a>&nbsp;&nbsp;&nbsp;'U'</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#4b0f005a000554c1d775ab8f10df5f9e">SYNC_POS</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#bc2a6d773bdd1189d74153dfe10a6430">TO_POS</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#90d773b30a70aa9c4e51628716e42d48">WORD_FIRST_DATA_POS</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#2bab1f3bd066faa428e782b7417bc18a">Comm_Flag</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check Communication Status.  <a href="#2bab1f3bd066faa428e782b7417bc18a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#bebcf5dbdcea576a31271721d411de4d">Comm_Handle</a> (<a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *sbsCmdDestination)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse command.  <a href="#bebcf5dbdcea576a31271721d411de4d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#98a59b5ab5cde59154465aab070afa30">Comm_Init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize TWI module.  <a href="#98a59b5ab5cde59154465aab070afa30"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#671390135cd0d30125661704332715a5">Comm_IsIdle</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check Communication State.  <a href="#671390135cd0d30125661704332715a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#1efd4641b8a2e2b7d2daddb0b38245a6">Comm_SbsBlockCommandReply</a> (<a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *<a class="el" href="main_8c.html#79cdcc825d6c642cfb1115bb757a4e82">sbsReply</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reply to a SBS read block command.  <a href="#1efd4641b8a2e2b7d2daddb0b38245a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#6f68436ccb337585587e7fa8ca888bda">Comm_SbsWordCommandReply</a> (<a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *<a class="el" href="main_8c.html#79cdcc825d6c642cfb1115bb757a4e82">sbsReply</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reply to a SBS read word command.  <a href="#6f68436ccb337585587e7fa8ca888bda"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="communication_8h.html#f36a453998529f2d658b7127cf44fb1d">Comm_SendACK</a> ()</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="1d5960c341cd7b2473003746f892a2e3"></a><!-- doxytag: member="communication.h::ALL_GROUP" ref="1d5960c341cd7b2473003746f892a2e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALL_GROUP&nbsp;&nbsp;&nbsp;'A'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00065">65</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="94d63e531eff73dc6747af91e974bdd6"></a><!-- doxytag: member="communication.h::BLOCK_CDE_POS" ref="94d63e531eff73dc6747af91e974bdd6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK_CDE_POS&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00074">74</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="1d737b9dfdab54c4a9ae6c4100bab71e"></a><!-- doxytag: member="communication.h::BLOCK_SIZE_POS" ref="1d737b9dfdab54c4a9ae6c4100bab71e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK_SIZE_POS&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00075">75</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="ef97e91fe131cdda36c51332ff6ac261"></a><!-- doxytag: member="communication.h::CDE_POS" ref="ef97e91fe131cdda36c51332ff6ac261" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CDE_POS&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00060">60</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="58dd4165844424cf00b762f0cc85c4a2"></a><!-- doxytag: member="communication.h::CHARGER" ref="58dd4165844424cf00b762f0cc85c4a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHARGER&nbsp;&nbsp;&nbsp;'C'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00066">66</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="101b8f769b32df10518a960c05f0010d"></a><!-- doxytag: member="communication.h::COMM_ACK" ref="101b8f769b32df10518a960c05f0010d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COMM_ACK&nbsp;&nbsp;&nbsp;0xFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00088">88</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="43bb5d11c19dcc66897d32bc67dfadb8"></a><!-- doxytag: member="communication.h::COMM_NACK" ref="43bb5d11c19dcc66897d32bc67dfadb8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define COMM_NACK&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00087">87</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="c23a924aa04ddcf6d90e18ccfc1e27aa"></a><!-- doxytag: member="communication.h::DATA_LENGTH_POS" ref="c23a924aa04ddcf6d90e18ccfc1e27aa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DATA_LENGTH_POS&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00061">61</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="70bac867ff718b68d5017d9ccebfa812"></a><!-- doxytag: member="communication.h::DB101_DISPLAY" ref="70bac867ff718b68d5017d9ccebfa812" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DB101_DISPLAY&nbsp;&nbsp;&nbsp;'D'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00067">67</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="9614fa361339d5d83b4e3792b3d19682"></a><!-- doxytag: member="communication.h::ELECTRONIC_LOAD" ref="9614fa361339d5d83b4e3792b3d19682" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ELECTRONIC_LOAD&nbsp;&nbsp;&nbsp;'E'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00068">68</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="9a07396be342a97aabe7ec43ce63055d"></a><!-- doxytag: member="communication.h::FIRST_DATA_POS" ref="9a07396be342a97aabe7ec43ce63055d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FIRST_DATA_POS&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00062">62</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="50a2ff74b7c5f0e436d38978399043c5"></a><!-- doxytag: member="communication.h::FROM_POS" ref="50a2ff74b7c5f0e436d38978399043c5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FROM_POS&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00059">59</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="4ee9639c356507c268badf70158dd745"></a><!-- doxytag: member="communication.h::MAIN_CONTROLLER" ref="4ee9639c356507c268badf70158dd745" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAIN_CONTROLLER&nbsp;&nbsp;&nbsp;'M'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00069">69</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="cf44c6363fce11e480dbb2f3b60ed2cb"></a><!-- doxytag: member="communication.h::MSK_RW_BIT_CDE" ref="cf44c6363fce11e480dbb2f3b60ed2cb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSK_RW_BIT_CDE&nbsp;&nbsp;&nbsp;0x7F          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00080">80</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="3bc1c582723236e7052bd77cc458a098"></a><!-- doxytag: member="communication.h::PC_USB" ref="3bc1c582723236e7052bd77cc458a098" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PC_USB&nbsp;&nbsp;&nbsp;'P'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00070">70</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="75189763dbbb96aa3f1e34262bab6382"></a><!-- doxytag: member="communication.h::SBS_READ" ref="75189763dbbb96aa3f1e34262bab6382" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SBS_READ&nbsp;&nbsp;&nbsp;(0x80)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00082">82</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

<p>Referenced by <a class="el" href="smbus_8c-source.html#l00216">Comm_Handle()</a>, and <a class="el" href="main_8c-source.html#l01076">handleSBSCommand()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d5500c9b9dd285eaa77e28413d7258df"></a><!-- doxytag: member="communication.h::SBS_WRITE" ref="d5500c9b9dd285eaa77e28413d7258df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SBS_WRITE&nbsp;&nbsp;&nbsp;(0x00)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00081">81</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

<p>Referenced by <a class="el" href="smbus_8c-source.html#l00216">Comm_Handle()</a>, and <a class="el" href="main_8c-source.html#l01076">handleSBSCommand()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ec97336349161e762ff43396753223f2"></a><!-- doxytag: member="communication.h::SMART_BATTERY" ref="ec97336349161e762ff43396753223f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SMART_BATTERY&nbsp;&nbsp;&nbsp;'S'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00071">71</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="9ac82e856c7683e23553431e5224d5f4"></a><!-- doxytag: member="communication.h::SYNC" ref="9ac82e856c7683e23553431e5224d5f4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SYNC&nbsp;&nbsp;&nbsp;'U'          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00085">85</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="4b0f005a000554c1d775ab8f10df5f9e"></a><!-- doxytag: member="communication.h::SYNC_POS" ref="4b0f005a000554c1d775ab8f10df5f9e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SYNC_POS&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00057">57</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="bc2a6d773bdd1189d74153dfe10a6430"></a><!-- doxytag: member="communication.h::TO_POS" ref="bc2a6d773bdd1189d74153dfe10a6430" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TO_POS&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00058">58</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="90d773b30a70aa9c4e51628716e42d48"></a><!-- doxytag: member="communication.h::WORD_FIRST_DATA_POS" ref="90d773b30a70aa9c4e51628716e42d48" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WORD_FIRST_DATA_POS&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="communication_8h-source.html#l00078">78</a> of file <a class="el" href="communication_8h-source.html">communication.h</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="2bab1f3bd066faa428e782b7417bc18a"></a><!-- doxytag: member="communication.h::Comm_Flag" ref="2bab1f3bd066faa428e782b7417bc18a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="stdint_8h.html#ba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> Comm_Flag           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check Communication Status. 
<p>
This function returns 0, if it is nothing to handle. If it is &gt; 0, then execute <a class="el" href="communication_8c.html#bebcf5dbdcea576a31271721d411de4d" title="Parse command.">Comm_Handle()</a><p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if there is nothing to handle, 1 is there is</dd></dl>
This function returns 0, if it is nothing to handle. If it is &gt; 0, then execute <a class="el" href="communication_8c.html#bebcf5dbdcea576a31271721d411de4d" title="Parse command.">Comm_Handle()</a><p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 if there is nothing to handle, &gt; 0 there is </dd></dl>

<p>Definition at line <a class="el" href="communication_8c-source.html#l00331">331</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00332"></a>00332 {
<a name="l00333"></a>00333     <span class="keywordflow">return</span> 0;
<a name="l00334"></a>00334 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bebcf5dbdcea576a31271721d411de4d"></a><!-- doxytag: member="communication.h::Comm_Handle" ref="bebcf5dbdcea576a31271721d411de4d" args="(SBS_command_t *sbsCmdDestination)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Comm_Handle           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *&nbsp;</td>
          <td class="paramname"> <em>sbsCmdDestination</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parse command. 
<p>
Check the command and send message to SBS for the protocol layer<p>
It is important that if this function return true (receive is complete) that it is handles before this function is called again<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sbsCmdDestination</em>&nbsp;</td><td>Where to save the incoming data</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True if a new command has been received and transferred to the destination buffer.</dd></dl>
Check the command and send message to SBS for the protocol layer<p>
It is important that if this function return true (receive is complete) that it is handles before this function is called again<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sbsCmdDestination</em>&nbsp;</td><td>Where to save the incoming data</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>True if a new command has been received and transferred to the destination buffer. </dd></dl>

<p>Definition at line <a class="el" href="communication_8c-source.html#l00194">194</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keywordtype">bool</span> receiveComplete = <span class="keyword">false</span>;
<a name="l00197"></a>00197     <span class="comment">/*</span>
<a name="l00198"></a>00198 <span class="comment">    // Clear the flag as early as possible to allow it to be set again and this</span>
<a name="l00199"></a>00199 <span class="comment">    // function called again</span>
<a name="l00200"></a>00200 <span class="comment">    CLEAR_FLAG(SW_UART_status, SW_UART_RX_COMPLETE );</span>
<a name="l00201"></a>00201 <span class="comment">    </span>
<a name="l00202"></a>00202 <span class="comment">    if( READ_FLAG(SW_UART_status, SW_UART_FRAME_ERROR) ) {</span>
<a name="l00203"></a>00203 <span class="comment">        // If a frame error has been received, treat it as a break and wait for </span>
<a name="l00204"></a>00204 <span class="comment">        // next command</span>
<a name="l00205"></a>00205 <span class="comment">        CLEAR_FLAG(SW_UART_status, SW_UART_FRAME_ERROR);</span>
<a name="l00206"></a>00206 <span class="comment">        CLEAR_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW);</span>
<a name="l00207"></a>00207 <span class="comment">        COMM_State = COMM_WAITING_FOR_COMMAND;</span>
<a name="l00208"></a>00208 <span class="comment">        </span>
<a name="l00209"></a>00209 <span class="comment">    } else if( READ_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW) ) {</span>
<a name="l00210"></a>00210 <span class="comment">        // If a buffer overflow occured, wait for a break</span>
<a name="l00211"></a>00211 <span class="comment">        CLEAR_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW);</span>
<a name="l00212"></a>00212 <span class="comment">        COMM_State = COMM_WAITING_FOR_BREAK;</span>
<a name="l00213"></a>00213 <span class="comment">    } else {</span>
<a name="l00214"></a>00214 <span class="comment">        </span>
<a name="l00215"></a>00215 <span class="comment">        // Handle received data if any</span>
<a name="l00216"></a>00216 <span class="comment">        while( SW_UART_Data_Available() ) {</span>
<a name="l00217"></a>00217 <span class="comment">            if(receiveComplete) {</span>
<a name="l00218"></a>00218 <span class="comment">                // If receive is complete, but there is still data in the RX buffer, </span>
<a name="l00219"></a>00219 <span class="comment">                // something went wrong so reset everything and wait for a break</span>
<a name="l00220"></a>00220 <span class="comment">                CLEAR_FLAG(SW_UART_status, SW_UART_FRAME_ERROR);</span>
<a name="l00221"></a>00221 <span class="comment">                CLEAR_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW);</span>
<a name="l00222"></a>00222 <span class="comment">                receiveComplete = false;</span>
<a name="l00223"></a>00223 <span class="comment">                SW_UART_Flush_Buffers();</span>
<a name="l00224"></a>00224 <span class="comment">                COMM_State = COMM_WAITING_FOR_BREAK;</span>
<a name="l00225"></a>00225 <span class="comment">                </span>
<a name="l00226"></a>00226 <span class="comment">            } else if( READ_FLAG(SW_UART_status, SW_UART_FRAME_ERROR) ) {</span>
<a name="l00227"></a>00227 <span class="comment">                // If a frame error has been received, treat it as a break and wait for </span>
<a name="l00228"></a>00228 <span class="comment">                // next command</span>
<a name="l00229"></a>00229 <span class="comment">                CLEAR_FLAG(SW_UART_status, SW_UART_FRAME_ERROR);</span>
<a name="l00230"></a>00230 <span class="comment">                CLEAR_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW);</span>
<a name="l00231"></a>00231 <span class="comment">                COMM_State = COMM_WAITING_FOR_COMMAND;</span>
<a name="l00232"></a>00232 <span class="comment">                </span>
<a name="l00233"></a>00233 <span class="comment">            } else if( READ_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW) ) {</span>
<a name="l00234"></a>00234 <span class="comment">                // If a buffer overflow occured, wait for a break</span>
<a name="l00235"></a>00235 <span class="comment">                CLEAR_FLAG(SW_UART_status, SW_UART_RX_BUFFER_OVERFLOW);</span>
<a name="l00236"></a>00236 <span class="comment">                COMM_State = COMM_WAITING_FOR_BREAK;</span>
<a name="l00237"></a>00237 <span class="comment">                </span>
<a name="l00238"></a>00238 <span class="comment">            } else {</span>
<a name="l00239"></a>00239 <span class="comment">                // Get the received data</span>
<a name="l00240"></a>00240 <span class="comment">                uint8_t data = SW_UART_Getchar();</span>
<a name="l00241"></a>00241 <span class="comment">                </span>
<a name="l00242"></a>00242 <span class="comment">                switch( COMM_State ) {</span>
<a name="l00243"></a>00243 <span class="comment">                case COMM_WAITING_FOR_BREAK:</span>
<a name="l00244"></a>00244 <span class="comment">                    {</span>
<a name="l00245"></a>00245 <span class="comment">                        // Do nothing. Break is handled outside the case switch</span>
<a name="l00246"></a>00246 <span class="comment">                        break;</span>
<a name="l00247"></a>00247 <span class="comment">                    }</span>
<a name="l00248"></a>00248 <span class="comment">                case COMM_WAITING_FOR_COMMAND:</span>
<a name="l00249"></a>00249 <span class="comment">                    {</span>
<a name="l00250"></a>00250 <span class="comment">                        // Allow to transmit data</span>
<a name="l00251"></a>00251 <span class="comment">                        CLEAR_FLAG(SW_UART_status, SW_UART_DECLINE_NEW_TX_DATA);</span>
<a name="l00252"></a>00252 <span class="comment">                        // Save command</span>
<a name="l00253"></a>00253 <span class="comment">                        sbsCmdDestination-&gt;command = (SBS_commands_t)data;</span>
<a name="l00254"></a>00254 <span class="comment">                        if( data &amp; 0x80 ) {</span>
<a name="l00255"></a>00255 <span class="comment">                            // Read command</span>
<a name="l00256"></a>00256 <span class="comment">                            receiveComplete = true;</span>
<a name="l00257"></a>00257 <span class="comment">                            COMM_State = COMM_WAITING_FOR_COMMAND;</span>
<a name="l00258"></a>00258 <span class="comment">                        } else {</span>
<a name="l00259"></a>00259 <span class="comment">                            // Write command</span>
<a name="l00260"></a>00260 <span class="comment">                            COMM_State = COMM_RECEIVING_DATA;</span>
<a name="l00261"></a>00261 <span class="comment">                            COMM_ReceivedBytes = 0;</span>
<a name="l00262"></a>00262 <span class="comment">                            </span>
<a name="l00263"></a>00263 <span class="comment">                            // Since only write commands are handled here, no need to remove</span>
<a name="l00264"></a>00264 <span class="comment">                            // the read/write bit when checking for block</span>
<a name="l00265"></a>00265 <span class="comment">                            if(   SBS_IsCommandStaticStringType((SBS_commands_t)(data))</span>
<a name="l00266"></a>00266 <span class="comment">                                 || SBS_IsCommandBlockDataType((SBS_commands_t)(data)) )</span>
<a name="l00267"></a>00267 <span class="comment">                            {</span>
<a name="l00268"></a>00268 <span class="comment">                                // Block command</span>
<a name="l00269"></a>00269 <span class="comment">                                COMM_BytesToReceive = SBSDATA_BLOCK_LENGTH ;</span>
<a name="l00270"></a>00270 <span class="comment">                            } else {</span>
<a name="l00271"></a>00271 <span class="comment">                                // Word command</span>
<a name="l00272"></a>00272 <span class="comment">                                COMM_BytesToReceive = 2;</span>
<a name="l00273"></a>00273 <span class="comment">                            }</span>
<a name="l00274"></a>00274 <span class="comment">                        }</span>
<a name="l00275"></a>00275 <span class="comment">                        //Send command back to the host and initialize the PEC</span>
<a name="l00276"></a>00276 <span class="comment">                        SW_UART_Transmit( data );</span>
<a name="l00277"></a>00277 <span class="comment">                        COMM_CalculatedPEC = 0;</span>
<a name="l00278"></a>00278 <span class="comment">                        CRC8_Update( &amp;COMM_CalculatedPEC, data);</span>
<a name="l00279"></a>00279 <span class="comment">                        break;</span>
<a name="l00280"></a>00280 <span class="comment">                    }</span>
<a name="l00281"></a>00281 <span class="comment">                    </span>
<a name="l00282"></a>00282 <span class="comment">                case COMM_RECEIVING_DATA:</span>
<a name="l00283"></a>00283 <span class="comment">                    {</span>
<a name="l00284"></a>00284 <span class="comment">                        if(COMM_ReceivedBytes == COMM_BytesToReceive) {</span>
<a name="l00285"></a>00285 <span class="comment">                            // All data bytes have been received, this is the PEC</span>
<a name="l00286"></a>00286 <span class="comment">                            if( data == COMM_CalculatedPEC ) {</span>
<a name="l00287"></a>00287 <span class="comment">                                receiveComplete = true;</span>
<a name="l00288"></a>00288 <span class="comment">                                // The function that handles receiveComplete has to send ACK</span>
<a name="l00289"></a>00289 <span class="comment">                                //  for write commands</span>
<a name="l00290"></a>00290 <span class="comment">                            } else {</span>
<a name="l00291"></a>00291 <span class="comment">                                // If the PEC was wrong, send NACK</span>
<a name="l00292"></a>00292 <span class="comment">                                SW_UART_Transmit(COMM_NACK);</span>
<a name="l00293"></a>00293 <span class="comment">                                COMM_State = COMM_WAITING_FOR_COMMAND;</span>
<a name="l00294"></a>00294 <span class="comment">                            }</span>
<a name="l00295"></a>00295 <span class="comment">                        } else {</span>
<a name="l00296"></a>00296 <span class="comment">                            // Add received byte to receive buffer and update PEC</span>
<a name="l00297"></a>00297 <span class="comment">                            sbsCmdDestination-&gt;payload[COMM_ReceivedBytes++] = data;</span>
<a name="l00298"></a>00298 <span class="comment">                            CRC8_Update(&amp;COMM_CalculatedPEC, data);</span>
<a name="l00299"></a>00299 <span class="comment">                        }</span>
<a name="l00300"></a>00300 <span class="comment">                        break;</span>
<a name="l00301"></a>00301 <span class="comment">                    }</span>
<a name="l00302"></a>00302 <span class="comment">                } // switch(COMM_state)</span>
<a name="l00303"></a>00303 <span class="comment">            }</span>
<a name="l00304"></a>00304 <span class="comment">        } // while( SW_UART_Data_Available() )</span>
<a name="l00305"></a>00305 <span class="comment">    }</span>
<a name="l00306"></a>00306 <span class="comment">    */</span>
<a name="l00307"></a>00307     <span class="keywordflow">return</span> receiveComplete;
<a name="l00308"></a>00308 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="98a59b5ab5cde59154465aab070afa30"></a><!-- doxytag: member="communication.h::Comm_Init" ref="98a59b5ab5cde59154465aab070afa30" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Comm_Init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize TWI module. 
<p>
This function initializes the TWI module for SMBus operation. 
<p>Definition at line <a class="el" href="communication_8c-source.html#l00106">106</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <a class="code" href="communication_8c.html#a43740bb86658af2f20234cc35e87e1c">SMB_RestoreBus</a>();
<a name="l00109"></a>00109     TWBCSR = (1&lt;&lt;TWBCIF) | (1&lt;&lt;TWBCIE) | (1&lt;&lt;TWBDT1) | (1&lt;&lt;TWBDT0) | (0&lt;&lt;TWBCIP);
<a name="l00110"></a>00110 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="671390135cd0d30125661704332715a5"></a><!-- doxytag: member="communication.h::Comm_IsIdle" ref="671390135cd0d30125661704332715a5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Comm_IsIdle           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check Communication State. 
<p>
This function returns true, if it is no ongoing comm. Then it is safe to enter psave<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>true if idle, false if busy </dd></dl>

<p>Definition at line <a class="el" href="communication_8c-source.html#l00318">318</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00319"></a>00319 {
<a name="l00320"></a>00320     <span class="keywordflow">return</span> 1;
<a name="l00321"></a>00321 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1efd4641b8a2e2b7d2daddb0b38245a6"></a><!-- doxytag: member="communication.h::Comm_SbsBlockCommandReply" ref="1efd4641b8a2e2b7d2daddb0b38245a6" args="(SBS_command_t *sbsReply)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Comm_SbsBlockCommandReply           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *&nbsp;</td>
          <td class="paramname"> <em>sbsReply</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reply to a SBS read block command. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sbsReply</em>&nbsp;</td><td>Is a pointer to the <a class="el" href="sbs__commands_8h.html#7951eae382c2d28b982454594bb80e21">SBS_command_t</a> struct containing the data to transmit. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="communication_8c-source.html#l00153">153</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00154"></a>00154 {
<a name="l00155"></a>00155 <span class="comment">/*  // Send the Data Payload and update PEC</span>
<a name="l00156"></a>00156 <span class="comment">    for( uint8_t i=0; i &lt; SBSDATA_BLOCK_LENGTH; i++)</span>
<a name="l00157"></a>00157 <span class="comment">    {</span>
<a name="l00158"></a>00158 <span class="comment">        SW_UART_Transmit( sbsReply-&gt;payload[i] );</span>
<a name="l00159"></a>00159 <span class="comment">        CRC8_Update(&amp;COMM_CalculatedPEC, sbsReply-&gt;payload[i] );</span>
<a name="l00160"></a>00160 <span class="comment">    }</span>
<a name="l00161"></a>00161 <span class="comment">    // Send the PEC</span>
<a name="l00162"></a>00162 <span class="comment">    SW_UART_Transmit( COMM_CalculatedPEC );</span>
<a name="l00163"></a>00163 <span class="comment">    */</span>
<a name="l00164"></a>00164 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6f68436ccb337585587e7fa8ca888bda"></a><!-- doxytag: member="communication.h::Comm_SbsWordCommandReply" ref="6f68436ccb337585587e7fa8ca888bda" args="(SBS_command_t *sbsReply)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Comm_SbsWordCommandReply           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="unionSBS__command__union.html">SBS_command_t</a> *&nbsp;</td>
          <td class="paramname"> <em>sbsReply</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reply to a SBS read word command. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sbsReply</em>&nbsp;</td><td>Is a pointer to the <a class="el" href="sbs__commands_8h.html#7951eae382c2d28b982454594bb80e21">SBS_command_t</a> struct containing the data to transmit. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="communication_8c-source.html#l00170">170</a> of file <a class="el" href="communication_8c-source.html">communication.c</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00171"></a>00171 {
<a name="l00172"></a>00172 <span class="comment">/*  // Send the Data Payload</span>
<a name="l00173"></a>00173 <span class="comment">    SW_UART_Transmit( sbsReply-&gt;payload[0] );</span>
<a name="l00174"></a>00174 <span class="comment">    SW_UART_Transmit( sbsReply-&gt;payload[1] );</span>
<a name="l00175"></a>00175 <span class="comment">    // Calculate the PEC and send it</span>
<a name="l00176"></a>00176 <span class="comment">    CRC8_Update( &amp;COMM_CalculatedPEC, sbsReply-&gt;payload[0] );</span>
<a name="l00177"></a>00177 <span class="comment">    CRC8_Update( &amp;COMM_CalculatedPEC, sbsReply-&gt;payload[1] );</span>
<a name="l00178"></a>00178 <span class="comment">    SW_UART_Transmit( COMM_CalculatedPEC );</span>
<a name="l00179"></a>00179 <span class="comment">    */</span>
<a name="l00180"></a>00180 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f36a453998529f2d658b7127cf44fb1d"></a><!-- doxytag: member="communication.h::Comm_SendACK" ref="f36a453998529f2d658b7127cf44fb1d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Comm_SendACK           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Wed Aug 4 11:01:15 2010 for AVR474 Firmware User's Guide for SB202 by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.6</small></address>
    </td>
  </tr>

</table>
