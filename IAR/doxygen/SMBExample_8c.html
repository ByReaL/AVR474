<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=iso-8859-1">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="atmel-header_files/filelist.xml">
<link rel=Edit-Time-Data href="atmel-header_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>@DOC_TITLE@</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>ping.zhou</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>ping.zhou</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Created>2010-08-04T02:58:00Z</o:Created>
  <o:LastSaved>2010-08-04T02:58:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>51</o:Words>
  <o:Characters>297</o:Characters>
  <o:Company>Atmel</o:Company>
  <o:Lines>2</o:Lines>
  <o:Paragraphs>1</o:Paragraphs>
  <o:CharactersWithSpaces>347</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>150</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<link rel=Stylesheet type="text/css" media=all href="doxygen.css">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<table class=MsoNormalTable border=0 cellpadding=0 width="100%"
 style='width:100.0%;mso-cellspacing:1.5pt;background:white'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com"><span style='text-decoration:none;
  text-underline:none'><img border=0 width=109 height=50 id="_x0000_i1025"
  src=atmel.jpg></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span class=SpellE><strong><span style='font-size:24.0pt;
  font-family:Helvetica;color:black'>SmartBattery</span></strong></span><strong><span
  style='font-size:24.0pt;font-family:Helvetica;color:black'> Device
  Application Note</span></strong></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p><a href="http://www.atmel.com/products/AVR"><span style='text-decoration:
  none;text-underline:none'><img border=0 width=138 height=77 id="_x0000_i1026"
  src="AVR_logo_blue.gif"></span></a></p>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;mso-yfti-lastrow:yes;height:.75pt'>
  <td colspan=3 style='padding:.75pt .75pt .75pt .75pt;height:.75pt'
  background=blue.gif>
  <p class=MsoNormal><span style='font-size:1.0pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_29ae905079a6eb1b30b29288f24757bc.html">lib_mcu</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c2f2e611aade4b362b2bd89f67a7ad7a.html">sm_bus</a>
  </div>
</div>
<div class="contents">
<h1>SMBExample.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Atmel Corporation<p>
<ul>
<li>File : <a class="el" href="SMBExample_8c.html">SMBExample.c</a></li><li>Compiler : IAR EWAAVR 4.10b</li></ul>
<p>
<ul>
<li>Support mail : <a href="mailto:avr@atmel.com">avr@atmel.com</a></li></ul>
<p>
<ul>
<li>Supported devices : All AVR devices with a TWI module can be used. The example is written for ATmega32</li></ul>
<p>
<ul>
<li>AppNote : AVR316 - SMBus slave</li></ul>
<p>
<ul>
<li>Description : Application specific part of SMBus slave implementation. Actions based o</li></ul>
<p>
<dl class="rcs" compact><dt><b>Revision</b></dt><dd>5627 </dd></dl>
<dl class="rcs" compact><dt><b>Date</b></dt><dd>2009-05-15 14:49:21 +0800 (Fri, 15 May 2009) </dd></dl>

<p>Definition in file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>
<code>#include &lt;ioavr.h&gt;</code><br>
<code>#include &lt;inavr.h&gt;</code><br>
<code>#include &quot;<a class="el" href="SMBExample_8h-source.html">SMBExample.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="SMBSlave_8h-source.html">SMBSlave.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for SMBExample.c:</div>
<div class="dynsection">
<p><center><img src="SMBExample_8c__incl.gif" border="0" usemap="#lib_mcu/sm_bus/SMBExample.c_map" alt=""></center>
<map name="lib_mcu/sm_bus/SMBExample.c_map">
<area shape="rect" href="SMBExample_8h.html" title="SMBExample.h" alt="" coords="171,80,283,107"><area shape="rect" href="SMBSlave_8h.html" title="SMBSlave.h" alt="" coords="228,155,319,181"></map>
</div>

<p>
<a href="SMBExample_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#0948a2f2bb2fcb95e7681f2f624a2269">OutputLedBlock</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Output data block to LEDS on STK500.  <a href="#0948a2f2bb2fcb95e7681f2f624a2269"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#8f3db79f2ca9e287b3ebdb28da51f442">OutputLedByte</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Output 1 byte to LEDS on STK500.  <a href="#8f3db79f2ca9e287b3ebdb28da51f442"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#cf79be93e1ce5f2fad3da448e9d599b2">OutputLedWord</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Output 2 bytes to LEDS on STK500.  <a href="#cf79be93e1ce5f2fad3da448e9d599b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#5cba462a6c300e74f28f73f6274a66b5">ProcessMessage</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepares response to all supported protocols except Receive Byte.  <a href="#5cba462a6c300e74f28f73f6274a66b5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#d62558a9ac4e46e16d51ba623ef7525d">ProcessReceiveByte</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepares the response to a Receive Byte protocol..  <a href="#d62558a9ac4e46e16d51ba623ef7525d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#aa7366043c4b8c908450df0cba87ae64">ReadEepromByte</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns one byte from EEPROM at the current location of the EEPROM pointer.  <a href="#aa7366043c4b8c908450df0cba87ae64"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#fe7c933c036f418a6f2d42df520f3301">ReadEepromWord</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns two bytes from EEPROM at the current location of the EEPROM pointer.  <a href="#fe7c933c036f418a6f2d42df520f3301"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#6b2b442052e73e99fe19fe1613826e57">ReturnParameterTimesTwo</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Treat the incoming parameter as a word and return the parameter * 2.  <a href="#6b2b442052e73e99fe19fe1613826e57"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#46939d717b4181fd5b680afbe4eed4c3">ReturnSumOfBytes</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sums each byte received and returns the sum as a word.  <a href="#46939d717b4181fd5b680afbe4eed4c3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#0f977c2317bffa6e0c173b79f408f011">ReturnSwitchesPressed</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns switches pressed on STK500 as a number.  <a href="#0f977c2317bffa6e0c173b79f408f011"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#746ef9f2947d7468f86d6cafee508747">ReturnVendorString</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns a vendor string in response to a Block read.  <a href="#746ef9f2947d7468f86d6cafee508747"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#3dae646080960640600bc6aa47467a9a">SetEepromPointer</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sets the EEPROM pointer.  <a href="#3dae646080960640600bc6aa47467a9a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#08ef0d026f763c130beb882aca00df6c">UndefinedCommand</a> (SMBData *<a class="el" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666">smb</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handles undefined commands.  <a href="#08ef0d026f763c130beb882aca00df6c"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char __eeprom *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0">e2p</a> = (unsigned char __eeprom *)0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">EEPROM pointer, initialized to 0.  <a href="#2d6f2f8e12e211994f1d7f0f2dc374d0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned volatile char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d">ledIndex</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Index of the currently displayed LED value.  <a href="#d1adeeab2db0e25dd3ac7dd54225960d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned volatile char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585">ledLength</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of values to display on LEDs.  <a href="#8287b63ba5ab6dea614947c74358f585"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned volatile char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7">leds</a> [32]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Array of values to display on LEDs.  <a href="#508c212501d7aba57f41078f116887c7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char __eeprom&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="SMBExample_8c.html#49632fc94ba7af6bf47ce926204fb1a6">vendor</a> [] = &quot;ACME SMBus Devices&quot;</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Vendor ID string.  <a href="#49632fc94ba7af6bf47ce926204fb1a6"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0948a2f2bb2fcb95e7681f2f624a2269"></a><!-- doxytag: member="SMBExample.c::OutputLedBlock" ref="0948a2f2bb2fcb95e7681f2f624a2269" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void OutputLedBlock           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Output data block to LEDS on STK500. 
<p>
This function demonstrates how to use data received in a Block write protocol. The received data is output as a sequence to the LEDS of the STK500 (PORTB).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00365">365</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d">ledIndex</a>, <a class="el" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585">ledLength</a>, and <a class="el" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7">leds</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00366"></a>00366 {
<a name="l00367"></a>00367     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;
<a name="l00368"></a>00368     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byteCount;
<a name="l00369"></a>00369     byteCount = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1];
<a name="l00370"></a>00370     <span class="keywordflow">if</span> (RX_COUNT_AND_PEC_CHECK(byteCount+2))
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372         <span class="keywordflow">for</span> (i = 0; i  &lt; byteCount; i++)
<a name="l00373"></a>00373         {
<a name="l00374"></a>00374             <a class="code" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7" title="Array of values to display on LEDs.">leds</a>[i] = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[i + 2];
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         <a class="code" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585" title="Number of values to display on LEDs.">ledLength</a> = byteCount;
<a name="l00377"></a>00377         <a class="code" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d" title="Index of the currently displayed LED value.">ledIndex</a> = 0;
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     <span class="keywordflow">else</span>
<a name="l00380"></a>00380     {
<a name="l00381"></a>00381         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00385"></a>00385 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8f3db79f2ca9e287b3ebdb28da51f442"></a><!-- doxytag: member="SMBExample.c::OutputLedByte" ref="8f3db79f2ca9e287b3ebdb28da51f442" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void OutputLedByte           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Output 1 byte to LEDS on STK500. 
<p>
This function demonstrates how to use data received in a Write byte protocol. The received byte is output to the LEDS of the STK500 (PORTB).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00312">312</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d">ledIndex</a>, <a class="el" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585">ledLength</a>, and <a class="el" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7">leds</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00313"></a>00313 {
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (RX_COUNT_AND_PEC_CHECK(2))
<a name="l00315"></a>00315     {
<a name="l00316"></a>00316         <a class="code" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7" title="Array of values to display on LEDs.">leds</a>[0] = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1];
<a name="l00317"></a>00317         <a class="code" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585" title="Number of values to display on LEDs.">ledLength</a> = 1;
<a name="l00318"></a>00318         <a class="code" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d" title="Index of the currently displayed LED value.">ledIndex</a> = 0;
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     <span class="keywordflow">else</span>
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00326"></a>00326 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="cf79be93e1ce5f2fad3da448e9d599b2"></a><!-- doxytag: member="SMBExample.c::OutputLedWord" ref="cf79be93e1ce5f2fad3da448e9d599b2" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void OutputLedWord           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Output 2 bytes to LEDS on STK500. 
<p>
This function demonstrates how to use data received in a Write word protocol. The received data is output as a sequence to the LEDS of the STK500 (PORTB).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00338">338</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d">ledIndex</a>, <a class="el" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585">ledLength</a>, and <a class="el" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7">leds</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (RX_COUNT_AND_PEC_CHECK(3))
<a name="l00341"></a>00341     {
<a name="l00342"></a>00342         <a class="code" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7" title="Array of values to display on LEDs.">leds</a>[0] = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1];
<a name="l00343"></a>00343         <a class="code" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7" title="Array of values to display on LEDs.">leds</a>[1] = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[2];
<a name="l00344"></a>00344         <a class="code" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585" title="Number of values to display on LEDs.">ledLength</a> = 2;
<a name="l00345"></a>00345         <a class="code" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d" title="Index of the currently displayed LED value.">ledIndex</a> = 0;
<a name="l00346"></a>00346     }
<a name="l00347"></a>00347     <span class="keywordflow">else</span>
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00353"></a>00353 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5cba462a6c300e74f28f73f6274a66b5"></a><!-- doxytag: member="SMBExample.c::ProcessMessage" ref="5cba462a6c300e74f28f73f6274a66b5" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ProcessMessage           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepares response to all supported protocols except Receive Byte. 
<p>
This function gets called whenever a Write byte, Write word, Read byte, Read word, Process call, Block write, Block read or Block write, block read process call protocol is in progress. The function is called rigth after a Stop or Repeated start condition is received.<p>
This function, along with ProcessReceiveByte implements the application specific parts of the SMBus slave. For this reason, it can get very large. To remedy this, it has been broken up into one inlined function per command code.<p>
Since the TWI module does not diffrentiate between a Stop condition and a repeated start condition, it is important that smb-&gt;state is set in this function, to reflect the state of the SMBus driver.<p>
When this function is called, the data receieved is available through smb-&gt;rxBuffer array. All data received (excluding SLA+W) is available. The total number of valid bytes in smb-&gt;rxBuffer is available in smb-&gt;rxLength. The command code is always available in smb-&gt;rxBuffer[0]. The rest of the array is filled according to the SMBus specification.<p>
For Write byte, Write word and Block write, data must simply be copied to their destination. smb-&gt;state should then be set to SMB_STATE_IDLE before returning.<p>
For Read byte, Read word, Process call, Block read and Block write, block read process call, a response must be made ready and put in smb-txBuffer. The data in smb-&gt;txBuffer includes all data to be sent back by the SMBus driver (excluding PEC). The smb-&gt;txLength variable must be set to the total number of bytes to be transmitted (excluding PEC). When the response is complete, the smb-&gt; state variable should be set to SMB_STATE_WRITE_READ_REQUESTED before returning.<p>
In the following examples, it is explained how to prepare a response to these protocols.<p>
Read byte: <br>
 <code> smb-&gt;txBuffer[0] = Data byte <br>
 smb-&gt;txLength = 1 <br>
</code><p>
Read word / Process call: <br>
 <code> smb-&gt;txBuffer[0] = Data byte low <br>
 smb-&gt;txBuffer[1] = Data byte high <br>
 smb-&gt;txLength = 2 <br>
</code><p>
Block read / Block write, block read process call: <br>
<code> smb-&gt;txBuffer[0] = Byte count (n) <br>
 smb-&gt;txBuffer[1] = Data byte 1 <br>
 : <br>
 : <br>
 smb-&gt;txBuffer[n] = Data byte n <br>
 smb-&gt;txLength = n + 1 <br>
</code><p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>While this runs the SMBCLK is held low, and it is thus important to keep the functions short enough not to violate the SMBus T_LOW:SEXT of 25ms. If this happens, the master will time out and drop the lines, and since the AVR's TWI module is I2C compatible there is no timeout in the TWI module. The AVR can then hold the SMBDAT line low waiting for clock, and thus block the bus indefinitely. </dd></dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00124">124</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c-source.html#l00365">OutputLedBlock()</a>, <a class="el" href="SMBExample_8c-source.html#l00312">OutputLedByte()</a>, <a class="el" href="SMBExample_8c-source.html#l00338">OutputLedWord()</a>, <a class="el" href="SMBExample_8c-source.html#l00276">ReadEepromByte()</a>, <a class="el" href="SMBExample_8c-source.html#l00294">ReadEepromWord()</a>, <a class="el" href="SMBExample_8c-source.html#l00398">ReturnParameterTimesTwo()</a>, <a class="el" href="SMBExample_8c-source.html#l00432">ReturnSumOfBytes()</a>, <a class="el" href="SMBExample_8c-source.html#l00217">ReturnSwitchesPressed()</a>, <a class="el" href="SMBExample_8c-source.html#l00189">ReturnVendorString()</a>, <a class="el" href="SMBExample_8c-source.html#l00235">SetEepromPointer()</a>, <a class="el" href="SMBExample_8h-source.html#l00036">SMB_COMMAND_MULTIPLY_BY_TWO</a>, <a class="el" href="SMBExample_8h-source.html#l00031">SMB_COMMAND_READ_EE_BYTE</a>, <a class="el" href="SMBExample_8h-source.html#l00032">SMB_COMMAND_READ_EE_WORD</a>, <a class="el" href="SMBExample_8h-source.html#l00029">SMB_COMMAND_RETURN_SWITCHES</a>, <a class="el" href="SMBExample_8h-source.html#l00028">SMB_COMMAND_RETURN_VENDOR_STRING</a>, <a class="el" href="SMBExample_8h-source.html#l00030">SMB_COMMAND_SET_EE_POINTER</a>, <a class="el" href="SMBExample_8h-source.html#l00037">SMB_COMMAND_SUM_OF_BYTES</a>, <a class="el" href="SMBExample_8h-source.html#l00035">SMB_COMMAND_WRITE_LED_BLOCK</a>, <a class="el" href="SMBExample_8h-source.html#l00033">SMB_COMMAND_WRITE_LED_BYTE</a>, <a class="el" href="SMBExample_8h-source.html#l00034">SMB_COMMAND_WRITE_LED_WORD</a>, and <a class="el" href="SMBExample_8c-source.html#l00473">UndefinedCommand()</a>.</p>

<p>Referenced by <a class="el" href="SMBSlave_8c-source.html#l00086">SMBus_ISR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state == SMB_STATE_WRITE_REQUESTED)
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128         <span class="keywordflow">switch</span> (<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[0]) <span class="comment">// Command code.</span>
<a name="l00129"></a>00129         {
<a name="l00130"></a>00130             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#d6034ad0d72529d10f22ff3346bb9d82">SMB_COMMAND_RETURN_VENDOR_STRING</a>:  <span class="comment">// Block read, vendor ID.</span>
<a name="l00131"></a>00131                 <a class="code" href="SMBExample_8c.html#746ef9f2947d7468f86d6cafee508747" title="Returns a vendor string in response to a Block read.">ReturnVendorString</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00132"></a>00132                 <span class="keywordflow">break</span>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#719971191df08fcae859097794ab7d23">SMB_COMMAND_RETURN_SWITCHES</a>:  <span class="comment">// Read byte, buttons.</span>
<a name="l00135"></a>00135                 <a class="code" href="SMBExample_8c.html#0f977c2317bffa6e0c173b79f408f011" title="Returns switches pressed on STK500 as a number.">ReturnSwitchesPressed</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00136"></a>00136                 <span class="keywordflow">break</span>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#e1027d1453db8e1c98d0e79769cc3054">SMB_COMMAND_SET_EE_POINTER</a>:  <span class="comment">// Write word, EEPROM pointer.</span>
<a name="l00139"></a>00139                 <a class="code" href="SMBExample_8c.html#3dae646080960640600bc6aa47467a9a" title="Sets the EEPROM pointer.">SetEepromPointer</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00140"></a>00140                 <span class="keywordflow">break</span>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#a44a4000bb452fcbf18b59f0117bdb98">SMB_COMMAND_READ_EE_BYTE</a>:  <span class="comment">// Read byte, EEPROM data.</span>
<a name="l00143"></a>00143                 <a class="code" href="SMBExample_8c.html#aa7366043c4b8c908450df0cba87ae64" title="Returns one byte from EEPROM at the current location of the EEPROM pointer.">ReadEepromByte</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00144"></a>00144                 <span class="keywordflow">break</span>;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#cf822cab2cf061c4ca6506be8b87f594">SMB_COMMAND_READ_EE_WORD</a>:  <span class="comment">// Read word, EEPROM data.</span>
<a name="l00147"></a>00147                 <a class="code" href="SMBExample_8c.html#fe7c933c036f418a6f2d42df520f3301" title="Returns two bytes from EEPROM at the current location of the EEPROM pointer.">ReadEepromWord</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00148"></a>00148                 <span class="keywordflow">break</span>;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#53b3e115c56a814203a0ec589a5636ed">SMB_COMMAND_WRITE_LED_BYTE</a>:  <span class="comment">// Write byte, LEDs.</span>
<a name="l00151"></a>00151                 <a class="code" href="SMBExample_8c.html#8f3db79f2ca9e287b3ebdb28da51f442" title="Output 1 byte to LEDS on STK500.">OutputLedByte</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00152"></a>00152                 <span class="keywordflow">break</span>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#eeb5209cfcbfd4987706653faab11c6d">SMB_COMMAND_WRITE_LED_WORD</a>:  <span class="comment">// Write word, LEDs.</span>
<a name="l00155"></a>00155                 <a class="code" href="SMBExample_8c.html#cf79be93e1ce5f2fad3da448e9d599b2" title="Output 2 bytes to LEDS on STK500.">OutputLedWord</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00156"></a>00156                 <span class="keywordflow">break</span>;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#8d6579276962ceb57c807b89e6703ba5">SMB_COMMAND_WRITE_LED_BLOCK</a>:  <span class="comment">// Block write, LEDs.</span>
<a name="l00159"></a>00159                 <a class="code" href="SMBExample_8c.html#0948a2f2bb2fcb95e7681f2f624a2269" title="Output data block to LEDS on STK500.">OutputLedBlock</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00160"></a>00160                 <span class="keywordflow">break</span>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#c51b255107344fc628ea56703995e0be">SMB_COMMAND_MULTIPLY_BY_TWO</a>: <span class="comment">// Process call, Multiply by two.</span>
<a name="l00163"></a>00163                 <a class="code" href="SMBExample_8c.html#6b2b442052e73e99fe19fe1613826e57" title="Treat the incoming parameter as a word and return the parameter * 2.">ReturnParameterTimesTwo</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00164"></a>00164                 <span class="keywordflow">break</span>;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             <span class="keywordflow">case</span> <a class="code" href="SMBExample_8h.html#635a666ff995efcc0e9cfb22cf55176a">SMB_COMMAND_SUM_OF_BYTES</a>:  <span class="comment">// Block write, block read process call. Sum of bytes.</span>
<a name="l00167"></a>00167                 <a class="code" href="SMBExample_8c.html#46939d717b4181fd5b680afbe4eed4c3" title="Sums each byte received and returns the sum as a word.">ReturnSumOfBytes</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00168"></a>00168                 <span class="keywordflow">break</span>;
<a name="l00169"></a>00169             <span class="keywordflow">default</span>:
<a name="l00170"></a>00170                 <a class="code" href="SMBExample_8c.html#08ef0d026f763c130beb882aca00df6c" title="Handles undefined commands.">UndefinedCommand</a>(<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>);
<a name="l00171"></a>00171                 <span class="keywordflow">break</span>;
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <span class="keywordflow">else</span>
<a name="l00175"></a>00175     {
<a name="l00176"></a>00176         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178 }
</pre></div>
<p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="SMBExample_8c_5cba462a6c300e74f28f73f6274a66b5_cgraph.gif" border="0" usemap="#SMBExample_8c_5cba462a6c300e74f28f73f6274a66b5_cgraph_map" alt=""></center>
<map name="SMBExample_8c_5cba462a6c300e74f28f73f6274a66b5_cgraph_map">
<area shape="rect" href="SMBExample_8c.html#0948a2f2bb2fcb95e7681f2f624a2269" title="Output data block to LEDS on STK500." alt="" coords="208,5,323,32"><area shape="rect" href="SMBExample_8c.html#8f3db79f2ca9e287b3ebdb28da51f442" title="Output 1 byte to LEDS on STK500." alt="" coords="212,56,319,83"><area shape="rect" href="SMBExample_8c.html#cf79be93e1ce5f2fad3da448e9d599b2" title="Output 2 bytes to LEDS on STK500." alt="" coords="209,107,321,133"><area shape="rect" href="SMBExample_8c.html#aa7366043c4b8c908450df0cba87ae64" title="Returns one byte from EEPROM at the current location of the EEPROM pointer." alt="" coords="204,157,327,184"><area shape="rect" href="SMBExample_8c.html#fe7c933c036f418a6f2d42df520f3301" title="Returns two bytes from EEPROM at the current location of the EEPROM pointer." alt="" coords="201,208,329,235"><area shape="rect" href="SMBExample_8c.html#6b2b442052e73e99fe19fe1613826e57" title="Treat the incoming parameter as a word and return the parameter * 2." alt="" coords="177,259,353,285"><area shape="rect" href="SMBExample_8c.html#46939d717b4181fd5b680afbe4eed4c3" title="Sums each byte received and returns the sum as a word." alt="" coords="199,309,332,336"><area shape="rect" href="SMBExample_8c.html#0f977c2317bffa6e0c173b79f408f011" title="Returns switches pressed on STK500 as a number." alt="" coords="185,360,345,387"><area shape="rect" href="SMBExample_8c.html#746ef9f2947d7468f86d6cafee508747" title="Returns a vendor string in response to a Block read." alt="" coords="199,411,332,437"><area shape="rect" href="SMBExample_8c.html#3dae646080960640600bc6aa47467a9a" title="Sets the EEPROM pointer." alt="" coords="201,461,329,488"><area shape="rect" href="SMBExample_8c.html#08ef0d026f763c130beb882aca00df6c" title="Handles undefined commands." alt="" coords="197,512,333,539"></map>
</div>

</div>
</div><p>
<a class="anchor" name="d62558a9ac4e46e16d51ba623ef7525d"></a><!-- doxytag: member="SMBExample.c::ProcessReceiveByte" ref="d62558a9ac4e46e16d51ba623ef7525d" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ProcessReceiveByte           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepares the response to a Receive Byte protocol.. 
<p>
This function gets called whenever a SLA+R has been received right after a Start condition. If the Receive byte protocol is supported, data should be put in smb-&gt;txBuffer[0] and smb-&gt;txLength should be set to 1.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct.</td></tr>
  </table>
</dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>While this runs the SMBCLK is held low, and it is thus important to keep the functions short enough not to violate the SMBus T_LOW:SEXT of 25ms. If this happens, the master will time out and drop the lines, and since the AVR's TWI module is I2C compatible there is no timeout in the TWI module. The AVR can then hold the SMBDAT line low waiting for clock, and thus block the bus indefinitely. </dd></dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00052">52</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBSlave_8c-source.html#l00086">SMBus_ISR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = ~PIND;
<a name="l00055"></a>00055     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 1;
<a name="l00056"></a>00056 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="aa7366043c4b8c908450df0cba87ae64"></a><!-- doxytag: member="SMBExample.c::ReadEepromByte" ref="aa7366043c4b8c908450df0cba87ae64" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReadEepromByte           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns one byte from EEPROM at the current location of the EEPROM pointer. 
<p>
This function demonstrates how to set up a response to a Read byte request. The data byte pointed to by the EEPROM pointer will be transmitted when this function is invoked.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00276">276</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c-source.html#l00030">e2p</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00277"></a>00277 {
<a name="l00278"></a>00278     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = *<a class="code" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0" title="EEPROM pointer, initialized to 0.">e2p</a>;
<a name="l00279"></a>00279     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 1;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00282"></a>00282 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="fe7c933c036f418a6f2d42df520f3301"></a><!-- doxytag: member="SMBExample.c::ReadEepromWord" ref="fe7c933c036f418a6f2d42df520f3301" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReadEepromWord           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns two bytes from EEPROM at the current location of the EEPROM pointer. 
<p>
This function demonstrates how to set up a response to a Read word request. The data word pointed to by the EEPROM pointer will be transmitted when this function is invoked.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00294">294</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c-source.html#l00030">e2p</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00295"></a>00295 {
<a name="l00296"></a>00296     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = *<a class="code" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0" title="EEPROM pointer, initialized to 0.">e2p</a>;
<a name="l00297"></a>00297     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[1] = *(<a class="code" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0" title="EEPROM pointer, initialized to 0.">e2p</a> + 1);
<a name="l00298"></a>00298     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 2;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00301"></a>00301 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6b2b442052e73e99fe19fe1613826e57"></a><!-- doxytag: member="SMBExample.c::ReturnParameterTimesTwo" ref="6b2b442052e73e99fe19fe1613826e57" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReturnParameterTimesTwo           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Treat the incoming parameter as a word and return the parameter * 2. 
<p>
This function demonstrates how to use the Process call protocol. The incoming data is treated as one word-sized parameter. This incoming parameter is multiplied by 2 and transmitted as a word-sized value.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00398">398</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00399"></a>00399 {
<a name="l00400"></a>00400     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> temp;
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxCount == 3)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403         <span class="comment">// Multiply incoming data by 2</span>
<a name="l00404"></a>00404         temp = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1] | (<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[2] &lt;&lt; 8);
<a name="l00405"></a>00405         temp *= 2;
<a name="l00406"></a>00406         <span class="comment">// Send result back</span>
<a name="l00407"></a>00407         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = (<span class="keywordtype">unsigned</span> char)temp;        <span class="comment">// Low byte</span>
<a name="l00408"></a>00408         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[1] = (<span class="keywordtype">unsigned</span> char)(temp &gt;&gt; 8); <span class="comment">// High byte</span>
<a name="l00409"></a>00409         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 2;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413     <span class="keywordflow">else</span>
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="46939d717b4181fd5b680afbe4eed4c3"></a><!-- doxytag: member="SMBExample.c::ReturnSumOfBytes" ref="46939d717b4181fd5b680afbe4eed4c3" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReturnSumOfBytes           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sums each byte received and returns the sum as a word. 
<p>
This function demonstrates how to use the Block write, block read process call protocol. The received data is treated as a stream of byte-sized values. The sum of these values are calculated and transmitted back as a word-sized (2 bytes) value.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00432">432</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sum;
<a name="l00435"></a>00435     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;
<a name="l00436"></a>00436     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> byteCount;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     byteCount = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1];
<a name="l00439"></a>00439     <span class="keywordflow">if</span> (<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxCount == (byteCount + 2))
<a name="l00440"></a>00440     {
<a name="l00441"></a>00441         sum = 0;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443         <span class="comment">// Calculate sum of received bytes</span>
<a name="l00444"></a>00444         <span class="keywordflow">for</span> (i = 2; i &lt; byteCount + 2; i++)
<a name="l00445"></a>00445         {
<a name="l00446"></a>00446             sum += <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[i];
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <span class="comment">// Send result back</span>
<a name="l00450"></a>00450         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = 2;                          <span class="comment">// Number of bytes</span>
<a name="l00451"></a>00451         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[1] = (<span class="keywordtype">unsigned</span> char)sum;        <span class="comment">// Low byte</span>
<a name="l00452"></a>00452         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[2] = (<span class="keywordtype">unsigned</span> char)(sum &gt;&gt; 8); <span class="comment">// High byte</span>
<a name="l00453"></a>00453         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 3;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457     <span class="keywordflow">else</span>
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00460"></a>00460         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0f977c2317bffa6e0c173b79f408f011"></a><!-- doxytag: member="SMBExample.c::ReturnSwitchesPressed" ref="0f977c2317bffa6e0c173b79f408f011" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReturnSwitchesPressed           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns switches pressed on STK500 as a number. 
<p>
This function demonstrates how to set up a response to a Read byte request. The switches pressed on the STK500 will be transmitted as a byte-sized number.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00217">217</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00218"></a>00218 {
<a name="l00219"></a>00219     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = ~PIND;
<a name="l00220"></a>00220     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = 1;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00223"></a>00223 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="746ef9f2947d7468f86d6cafee508747"></a><!-- doxytag: member="SMBExample.c::ReturnVendorString" ref="746ef9f2947d7468f86d6cafee508747" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ReturnVendorString           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns a vendor string in response to a Block read. 
<p>
This function demonstrates how to set up a response to a Block read request. A vendor ID string will be transmitted when this function is invoked.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00189">189</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c-source.html#l00029">vendor</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;
<a name="l00192"></a>00192     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> temp;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     i = 0;
<a name="l00195"></a>00195     <span class="comment">// Copy vendor ID string from EEPROM.</span>
<a name="l00196"></a>00196     <span class="keywordflow">while</span> ((temp = <a class="code" href="SMBExample_8c.html#49632fc94ba7af6bf47ce926204fb1a6" title="Vendor ID string.">vendor</a>[i]) != <span class="charliteral">'\0'</span>)
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         i++;
<a name="l00199"></a>00199         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[i] = temp;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txBuffer[0] = i; <span class="comment">// Byte count.</span>
<a name="l00202"></a>00202     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;txLength = i + 1; <span class="comment">// Number of bytes to be transmitted including byte count.</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_WRITE_READ_REQUESTED;
<a name="l00205"></a>00205 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3dae646080960640600bc6aa47467a9a"></a><!-- doxytag: member="SMBExample.c::SetEepromPointer" ref="3dae646080960640600bc6aa47467a9a" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void SetEepromPointer           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sets the EEPROM pointer. 
<p>
This function demonstrates how to use data received in a Write word protocol. The data received is converted to an EEPROM pointer and used to fetch EEPROM data for other commands.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00235">235</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>References <a class="el" href="SMBExample_8c-source.html#l00030">e2p</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00236"></a>00236 {
<a name="l00237"></a>00237 <span class="comment">// If the largest EEPROM address is 0xff or less, a 1 byte EEPROM pointer is sufficient.</span>
<a name="l00238"></a>00238 <span class="comment">// Otherwise, a two byte pointer is used.</span>
<a name="l00239"></a>00239 <span class="preprocessor">#if E2END &lt;= 0xff</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tempData;
<a name="l00241"></a>00241 <span class="preprocessor">#else</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tempData;
<a name="l00243"></a>00243 <span class="preprocessor">#endif</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a>00245     <span class="keywordflow">if</span> ( RX_COUNT_AND_PEC_CHECK(3) )
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247 <span class="preprocessor">#if E2END &lt;= 0xff</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>        <span class="comment">// Cast received low byte to EEPROM pointer.</span>
<a name="l00249"></a>00249         tempData = <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1] &amp; E2END;
<a name="l00250"></a>00250         <a class="code" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0" title="EEPROM pointer, initialized to 0.">e2p</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> __eeprom *)(tempData);
<a name="l00251"></a>00251 <span class="preprocessor">#else</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>        <span class="comment">// Merge received bytes into one word and cast to EEPROM pointer.</span>
<a name="l00253"></a>00253         tempData = ((<a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[2] &lt;&lt; 8) | <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;rxBuffer[1]);
<a name="l00254"></a>00254         tempData &amp;= E2END;
<a name="l00255"></a>00255         <a class="code" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0" title="EEPROM pointer, initialized to 0.">e2p</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> __eeprom *)(tempData);
<a name="l00256"></a>00256 <span class="preprocessor">#endif</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>    }
<a name="l00258"></a>00258     <span class="keywordflow">else</span>
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260         <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00264"></a>00264 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="08ef0d026f763c130beb882aca00df6c"></a><!-- doxytag: member="SMBExample.c::UndefinedCommand" ref="08ef0d026f763c130beb882aca00df6c" args="(SMBData *smb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void UndefinedCommand           </td>
          <td>(</td>
          <td class="paramtype">SMBData *&nbsp;</td>
          <td class="paramname"> <em>smb</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handles undefined commands. 
<p>
This function will be called whenever an unrecognized command code is received.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>smb</em>&nbsp;</td><td>Pointer to the SMBus driver's SMBData struct. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00473">473</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00124">ProcessMessage()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00474"></a>00474 {
<a name="l00475"></a>00475     <span class="comment">// Handle undefined requests here.</span>
<a name="l00476"></a>00476     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;error = TRUE;
<a name="l00477"></a>00477     <a class="code" href="SMBSlave_8c.html#61d313edd59dcb471a4c000d3053c666" title="SMBus driver data.">smb</a>-&gt;state = SMB_STATE_IDLE;
<a name="l00478"></a>00478 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="2d6f2f8e12e211994f1d7f0f2dc374d0"></a><!-- doxytag: member="SMBExample.c::e2p" ref="2d6f2f8e12e211994f1d7f0f2dc374d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char __eeprom* <a class="el" href="SMBExample_8c.html#2d6f2f8e12e211994f1d7f0f2dc374d0">e2p</a> = (unsigned char __eeprom *)0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
EEPROM pointer, initialized to 0. 
<p>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00030">30</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00276">ReadEepromByte()</a>, <a class="el" href="SMBExample_8c-source.html#l00294">ReadEepromWord()</a>, and <a class="el" href="SMBExample_8c-source.html#l00235">SetEepromPointer()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d1adeeab2db0e25dd3ac7dd54225960d"></a><!-- doxytag: member="SMBExample.c::ledIndex" ref="d1adeeab2db0e25dd3ac7dd54225960d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned volatile char <a class="el" href="SMBExample_8c.html#d1adeeab2db0e25dd3ac7dd54225960d">ledIndex</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Index of the currently displayed LED value. 
<p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00365">OutputLedBlock()</a>, <a class="el" href="SMBExample_8c-source.html#l00312">OutputLedByte()</a>, and <a class="el" href="SMBExample_8c-source.html#l00338">OutputLedWord()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8287b63ba5ab6dea614947c74358f585"></a><!-- doxytag: member="SMBExample.c::ledLength" ref="8287b63ba5ab6dea614947c74358f585" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned volatile char <a class="el" href="SMBExample_8c.html#8287b63ba5ab6dea614947c74358f585">ledLength</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Number of values to display on LEDs. 
<p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00365">OutputLedBlock()</a>, <a class="el" href="SMBExample_8c-source.html#l00312">OutputLedByte()</a>, and <a class="el" href="SMBExample_8c-source.html#l00338">OutputLedWord()</a>.</p>

</div>
</div><p>
<a class="anchor" name="508c212501d7aba57f41078f116887c7"></a><!-- doxytag: member="SMBExample.c::leds" ref="508c212501d7aba57f41078f116887c7" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned volatile char <a class="el" href="SMBExample_8c.html#508c212501d7aba57f41078f116887c7">leds</a>[32]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Array of values to display on LEDs. 
<p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00365">OutputLedBlock()</a>, <a class="el" href="SMBExample_8c-source.html#l00312">OutputLedByte()</a>, and <a class="el" href="SMBExample_8c-source.html#l00338">OutputLedWord()</a>.</p>

</div>
</div><p>
<a class="anchor" name="49632fc94ba7af6bf47ce926204fb1a6"></a><!-- doxytag: member="SMBExample.c::vendor" ref="49632fc94ba7af6bf47ce926204fb1a6" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char __eeprom <a class="el" href="SMBExample_8c.html#49632fc94ba7af6bf47ce926204fb1a6">vendor</a>[] = &quot;ACME SMBus Devices&quot;          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Vendor ID string. 
<p>

<p>Definition at line <a class="el" href="SMBExample_8c-source.html#l00029">29</a> of file <a class="el" href="SMBExample_8c-source.html">SMBExample.c</a>.</p>

<p>Referenced by <a class="el" href="SMBExample_8c-source.html#l00189">ReturnVendorString()</a>.</p>

</div>
</div><p>
</div>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Wed Aug 4 11:01:49 2010 for AVR474 Firmware User's Guide for SB202 by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.6</small></address>
    </td>
  </tr>

</table>
